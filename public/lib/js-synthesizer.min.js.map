{"version":3,"file":"js-synthesizer.min.js","mappings":"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","sources":["webpack://JSSynth/webpack/universalModuleDefinition","webpack://JSSynth/webpack/bootstrap","webpack://JSSynth/webpack/runtime/define property getters","webpack://JSSynth/webpack/runtime/hasOwnProperty shorthand","webpack://JSSynth/webpack/runtime/make namespace object","webpack://JSSynth/./src/main/Constants.ts","webpack://JSSynth/./src/main/WasmManager.ts","webpack://JSSynth/./src/main/PointerType.ts","webpack://JSSynth/./src/main/SequencerEventData.ts","webpack://JSSynth/./src/main/ISequencerEventData.ts","webpack://JSSynth/./src/main/MessageError.ts","webpack://JSSynth/./src/main/MIDIEvent.ts","webpack://JSSynth/./src/main/Sequencer.ts","webpack://JSSynth/./src/main/Soundfont.ts","webpack://JSSynth/./src/main/logging.ts","webpack://JSSynth/./src/main/Synthesizer.ts","webpack://JSSynth/./src/main/waitForReady.ts","webpack://JSSynth/./src/main/MethodMessaging.ts","webpack://JSSynth/./src/main/WorkletSoundfont.ts","webpack://JSSynth/./src/main/WorkletSequencer.ts","webpack://JSSynth/./src/main/AudioWorkletNodeSynthesizer.ts","webpack://JSSynth/./src/main/version.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"js-synthesizer\"] = factory();\n\telse\n\t\troot[\"JSSynth\"] = factory();\n})(this, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\n/** Default values for synthesizer instances */\nexport const enum SynthesizerDefaultValues {\n\tGain = 0.5\n}\n\n/** Interpolation values used by ISynthesizer.setInterpolation */\nexport const enum InterpolationValues {\n\t/** No interpolation: Fastest, but questionable audio quality */\n\tNone = 0,\n\t/** Straight-line interpolation: A bit slower, reasonable audio quality */\n\tLinear = 1,\n\t/** Fourth-order interpolation, good quality, the default */\n\tFourthOrder = 4,\n\t/** Seventh-order interpolation */\n\tSeventhOrder = 7,\n\t/** Default interpolation method */\n\tDefault = FourthOrder,\n\t/** Highest interpolation method */\n\tHighest = SeventhOrder,\n}\n\n/** Chorus modulation waveform type, used by Synthesizer.setChorus etc. */\nexport const enum ChorusModulation {\n\t/** Sine wave chorus modulation */\n\tSine = 0,\n\t/** Triangle wave chorus modulation */\n\tTriangle = 1\n}\n\n/** Generator type ID (specified in SoundFont format) */\nexport const enum GeneratorTypes {\n\tStartAddrsOffset = 0,\n\tEndAddrsOffset = 1,\n\tStartLoopAddrsOffset = 2,\n\tEndLoopAddrsOffset = 3,\n\tStartAddrsCoarseOffset = 4,\n\tModLfoToPitch = 5,\n\tVibLfoToPitch = 6,\n\tModEnvToPitch = 7,\n\tInitialFilterFc = 8,\n\tInitialFilterQ = 9,\n\tModLfoToFilterFc = 10,\n\tModEnvToFilterFc = 11,\n\tEndAddrsCoarseOffset = 12,\n\tModLfoToVolume = 13,\n\t// 14: unused\n\tChorusEffectsSend = 15,\n\tReverbEffectsSend = 16,\n\tPan = 17,\n\t// 18-20: unused\n\tDelayModLFO = 21,\n\tFreqModLFO = 22,\n\tDelayVibLFO = 23,\n\tFreqVibLFO = 24,\n\tDelayModEnv = 25,\n\tAttackModEnv = 26,\n\tHoldModEnv = 27,\n\tDecayModEnv = 28,\n\tSustainModEnv = 29,\n\tReleaseModEnv = 30,\n\tKeynumToModEnvHold = 31,\n\tKeynumToModEnvDecay = 32,\n\tDelayVolEnv = 33,\n\tAttackVolEnv = 34,\n\tHoldVolEnv = 35,\n\tDecayVolEnv = 36,\n\tSustainVolEnv = 37,\n\tReleaseVolEnv = 38,\n\tKeynumToVolEnvHold = 39,\n\tKeynumToVolEnvDecay = 40,\n\tInstrument = 41,\n\t// 42: reserved\n\tKeyRange = 43,\n\tVelRange = 44,\n\tStartloopAddrsCoarseOffset = 45,\n\tKeynum = 46,\n\tVelocity = 47,\n\tInitialAttenuation = 48,\n\t// 49: reserved2\n\tEndloopAddrsCoarseOffset = 50,\n\tCoarseTune = 51,\n\tFineTune = 52,\n\tSampleID = 53,\n\tSampleModes = 54,\n\t// 55: reserved3\n\tScaleTuning = 56,\n\tExclusiveClass = 57,\n\tOverridingRootKey = 58,\n\n\t// Not in SoundFont specification\n\t_Pitch = 59,\n\t_CustomBalance = 60,\n\t_CustomFilterFc = 61,\n\t_CustomFilterQ = 62\n}\n\n/** Mono legato mode */\nexport const enum LegatoMode {\n\tRetrigger = 0,\n\tMultiRetrigger = 1\n}\n\n/** Portamento mode */\nexport const enum PortamentoMode {\n\tEachNote = 0,\n\tLegatoOnly = 1,\n\tStaccatoOnly = 2\n}\n\n/** Breath mode flags */\nexport const enum BreathFlags {\n\tPoly = 0x10,\n\tMono = 0x20,\n\tSync = 0x40\n}\n\n/** Tempo type for `Synthesizer.setPlayerTempo` */\nconst PlayerSetTempoType = {\n\tInternal: 0,\n\tExternalBpm: 1,\n\tExternalMidi: 2,\n} as const;\n/** Tempo type for `Synthesizer.setPlayerTempo` */\ntype PlayerSetTempoType = (typeof PlayerSetTempoType)[keyof typeof PlayerSetTempoType];\nexport { PlayerSetTempoType };\n","import type { MIDIEventType } from './MIDIEvent';\nimport PointerType, { UniquePointerType } from './PointerType';\n\n// @internal\ndeclare global {\n\tvar Module: any;\n\tfunction addFunction(func: Function, sig: string): number;\n\tfunction removeFunction(funcPtr: number): void;\n\tfunction addOnPostRun(cb: (Module: any) => void): void;\n}\n\n// @internal\nexport type SettingsId = UniquePointerType<\"settings_id\">;\n// @internal\nexport type SynthId = UniquePointerType<\"synth_id\">;\n// @internal\nexport type PlayerId = UniquePointerType<\"player_id\">;\n\n// @internal\nexport let _module: any;\n// @internal\nexport let _addFunction: (func: Function, sig: string) => number;\n// @internal\nexport let _removeFunction: (funcPtr: number) => void;\n// @internal\nexport let _fs: any;\nlet _addOnPostRunFn: ((cb: (Module: any) => void) => void) | undefined;\n\n// @internal\nexport let fluid_settings_setint: (settings: SettingsId, name: string, val: number) => number;\n// @internal\nexport let fluid_settings_setnum: (settings: SettingsId, name: string, val: number) => number;\n// @internal\nexport let fluid_settings_setstr: (settings: SettingsId, name: string, str: string) => number;\n// @internal\nexport let fluid_synth_error: undefined | ((synth: SynthId) => string);\n// @internal\nexport let fluid_synth_sfload: (synth: SynthId, filename: string, reset_presets: number) => number;\n// @internal\nexport let fluid_sequencer_register_client: (seq: PointerType, name: string, callback: number, data: number) => number;\n\n// @internal\nexport let malloc: (size: number) => PointerType;\n// @internal\nexport let free: (ptr: PointerType) => void;\n\n// @internal\nexport let defaultMIDIEventCallback: (data: PointerType, event: MIDIEventType) => number;\n\n// @internal\nexport function bindFunctions(module?: any): void {\n\tif (module == null && fluid_synth_error) {\n\t\t// (already bound)\n\t\treturn;\n\t}\n\n\tif (module != null) {\n\t\tif (!module.addFunction || !module.removeFunction || !module.addOnPostRun) {\n\t\t\tthrow new Error(\"Invalid 'module' object. libfluidsynth-*.js (2.4.6 or higher) must be used.\");\n\t\t}\n\t\t_module = module;\n\t\t_addFunction = _module.addFunction;\n\t\t_removeFunction = _module.removeFunction;\n\t\t_addOnPostRunFn = _module.addOnPostRun;\n\t} else if (typeof AudioWorkletGlobalScope !== \"undefined\") {\n\t\t_module = AudioWorkletGlobalScope.wasmModule;\n\t\t_addFunction = _module.addFunction || AudioWorkletGlobalScope.wasmAddFunction;\n\t\t_removeFunction = _module.removeFunction || AudioWorkletGlobalScope.wasmRemoveFunction;\n\t\t_addOnPostRunFn = _module.addOnPostRun || AudioWorkletGlobalScope.addOnPostRun;\n\t} else if (typeof Module !== \"undefined\") {\n\t\t_module = Module;\n\t\tif (_module.addFunction) {\n\t\t\t_addFunction = _module.addFunction;\n\t\t\t_removeFunction = _module.removeFunction;\n\t\t} else {\n\t\t\t_addFunction = addFunction;\n\t\t\t_removeFunction = removeFunction;\n\t\t}\n\t\tif (_module.addOnPostRun) {\n\t\t\t_addOnPostRunFn = _module.addOnPostRun;\n\t\t} else {\n\t\t\t_addOnPostRunFn = typeof addOnPostRun !== \"undefined\" ? addOnPostRun : undefined;\n\t\t}\n\t} else {\n\t\tthrow new Error(\n\t\t\t\"wasm module is not available. libfluidsynth-*.js must be loaded.\"\n\t\t);\n\t}\n\t_fs = _module.FS;\n\n\t// wrapper to use String type\n\tfluid_settings_setint = _module.cwrap(\"fluid_settings_setint\", \"number\", [\n\t\t\"number\",\n\t\t\"string\",\n\t\t\"number\",\n\t]);\n\tfluid_settings_setnum = _module.cwrap(\"fluid_settings_setnum\", \"number\", [\n\t\t\"number\",\n\t\t\"string\",\n\t\t\"number\",\n\t]);\n\tfluid_settings_setstr = _module.cwrap(\"fluid_settings_setstr\", \"number\", [\n\t\t\"number\",\n\t\t\"string\",\n\t\t\"string\",\n\t]);\n\tfluid_synth_error = _module.cwrap(\"fluid_synth_error\", \"string\", [\n\t\t\"number\",\n\t]);\n\tfluid_synth_sfload = _module.cwrap(\"fluid_synth_sfload\", \"number\", [\n\t\t\"number\",\n\t\t\"string\",\n\t\t\"number\",\n\t]);\n\tfluid_sequencer_register_client = _module.cwrap(\n\t\t\"fluid_sequencer_register_client\",\n\t\t\"number\",\n\t\t[\"number\", \"string\", \"number\", \"number\"]\n\t);\n\n\tmalloc = _module._malloc.bind(_module);\n\tfree = _module._free.bind(_module);\n\n\tdefaultMIDIEventCallback =\n\t\t_module._fluid_synth_handle_midi_event.bind(_module);\n}\n\nlet promiseWaitForInitialized: Promise<void> | undefined;\n// @internal\nexport function waitForInitialized(): Promise<void> {\n\tif (promiseWaitForInitialized) {\n\t\treturn promiseWaitForInitialized;\n\t}\n\n\ttry {\n\t\tbindFunctions();\n\t} catch (e: unknown) {\n\t\treturn Promise.reject(e);\n\t}\n\n\tif (_module.calledRun) {\n\t\tpromiseWaitForInitialized = Promise.resolve();\n\t\treturn promiseWaitForInitialized;\n\t}\n\tif (typeof _addOnPostRunFn === 'undefined') {\n\t\tpromiseWaitForInitialized = new Promise((resolve) => {\n\t\t\tconst fn: (() => void) | undefined = _module.onRuntimeInitialized;\n\t\t\t_module.onRuntimeInitialized = () => {\n\t\t\t\tresolve();\n\t\t\t\tif (fn) {\n\t\t\t\t\tfn();\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t} else {\n\t\tpromiseWaitForInitialized = new Promise((resolve) => {\n\t\t\t_addOnPostRunFn!(resolve);\n\t\t});\n\t}\n\treturn promiseWaitForInitialized;\n}\n","\ntype NullPointerType = number & { _null_pointer_marker: never; };\n\n/** @internal */\ntype PointerType = NullPointerType | (number & { _pointer_marker: never; });\n\nexport default PointerType;\n\ntype UniquePointerType<TMarker extends string> = NullPointerType | (number & {\n\t_pointer_marker: never;\n} & {\n\t[P in TMarker]: never;\n});\nexport { UniquePointerType };\n\nexport const INVALID_POINTER: NullPointerType = 0 as any as NullPointerType;\n","\nimport { EventType } from './SequencerEvent';\nimport ISequencerEventData from './ISequencerEventData';\nimport PointerType, { INVALID_POINTER } from './PointerType';\n\n/** @internal */\nexport default class SequencerEventData implements ISequencerEventData {\n\t/** @internal */\n\tconstructor(private _ptr: PointerType, private _module: any) {\n\t}\n\n\t/** @internal */\n\tpublic getRaw() {\n\t\treturn this._ptr;\n\t}\n\n\t/** @internal */\n\tpublic dispose() {\n\t\tthis._ptr = INVALID_POINTER;\n\t}\n\n\tpublic getType(): EventType {\n\t\tif (this._ptr === INVALID_POINTER) return -1 as any as EventType;\n\t\treturn this._module._fluid_event_get_type(this._ptr);\n\t}\n\tpublic getSource(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_source(this._ptr);\n\t}\n\tpublic getDest(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_dest(this._ptr);\n\t}\n\tpublic getChannel(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_channel(this._ptr);\n\t}\n\tpublic getKey(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_key(this._ptr);\n\t}\n\tpublic getVelocity(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_velocity(this._ptr);\n\t}\n\tpublic getControl(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_control(this._ptr);\n\t}\n\tpublic getValue(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_value(this._ptr);\n\t}\n\tpublic getProgram(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_program(this._ptr);\n\t}\n\tpublic getData(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_data(this._ptr);\n\t}\n\tpublic getDuration(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_duration(this._ptr);\n\t}\n\tpublic getBank(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_bank(this._ptr);\n\t}\n\tpublic getPitch(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_pitch(this._ptr);\n\t}\n\tpublic getSFontId(): number {\n\t\tif (this._ptr === INVALID_POINTER) return -1;\n\t\treturn this._module._fluid_event_get_sfont_id(this._ptr);\n\t}\n}\n","\nimport SequencerEvent, { EventType } from './SequencerEvent';\nimport { _module } from './WasmManager';\n\n/** @internal */\nimport PointerType, { INVALID_POINTER } from './PointerType';\n/** @internal */\nimport SequencerEventData from './SequencerEventData';\n\n/** Event data for sequencer callback. Only available in the callback function due to the instance lifetime. */\nexport default interface ISequencerEventData {\n\t/** Returns the event type */\n\tgetType(): EventType;\n\t/** Returns the source client id of event */\n\tgetSource(): number;\n\t/** Returns the destination client id of event */\n\tgetDest(): number;\n\tgetChannel(): number;\n\tgetKey(): number;\n\tgetVelocity(): number;\n\tgetControl(): number;\n\tgetValue(): number;\n\tgetProgram(): number;\n\tgetData(): number;\n\tgetDuration(): number;\n\tgetBank(): number;\n\tgetPitch(): number;\n\tgetSFontId(): number;\n}\n\n/** @internal */\nexport function rewriteEventDataImpl(ev: PointerType, event: SequencerEvent): boolean {\n\tswitch (event.type) {\n\t\tcase EventType.Note:\n\t\tcase 'note':\n\t\t\t_module._fluid_event_note(ev, event.channel, event.key, event.vel, event.duration);\n\t\t\tbreak;\n\t\tcase EventType.NoteOn:\n\t\tcase 'noteon':\n\t\tcase 'note-on':\n\t\t\t_module._fluid_event_noteon(ev, event.channel, event.key, event.vel);\n\t\t\tbreak;\n\t\tcase EventType.NoteOff:\n\t\tcase 'noteoff':\n\t\tcase 'note-off':\n\t\t\t_module._fluid_event_noteoff(ev, event.channel, event.key);\n\t\t\tbreak;\n\t\tcase EventType.AllSoundsOff:\n\t\tcase 'allsoundsoff':\n\t\tcase 'all-sounds-off':\n\t\t\t_module._fluid_event_all_sounds_off(ev, event.channel);\n\t\t\tbreak;\n\t\tcase EventType.AllNotesOff:\n\t\tcase 'allnotesoff':\n\t\tcase 'all-notes-off':\n\t\t\t_module._fluid_event_all_notes_off(ev, event.channel);\n\t\t\tbreak;\n\t\tcase EventType.BankSelect:\n\t\tcase 'bankselect':\n\t\tcase 'bank-select':\n\t\t\t_module._fluid_event_bank_select(ev, event.channel, event.bank);\n\t\t\tbreak;\n\t\tcase EventType.ProgramChange:\n\t\tcase 'programchange':\n\t\tcase 'program-change':\n\t\t\t_module._fluid_event_program_change(ev, event.channel, event.preset);\n\t\t\tbreak;\n\t\tcase EventType.ProgramSelect:\n\t\tcase 'programselect':\n\t\tcase 'program-select':\n\t\t\t_module._fluid_event_program_select(ev, event.channel, event.sfontId, event.bank, event.preset);\n\t\t\tbreak;\n\t\tcase EventType.ControlChange:\n\t\tcase 'controlchange':\n\t\tcase 'control-change':\n\t\t\t_module._fluid_event_control_change(ev, event.channel, event.control, event.value);\n\t\t\tbreak;\n\t\tcase EventType.PitchBend:\n\t\tcase 'pitchbend':\n\t\tcase 'pitch-bend':\n\t\t\t_module._fluid_event_pitch_bend(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.PitchWheelSensitivity:\n\t\tcase 'pitchwheelsens':\n\t\tcase 'pitchwheelsensitivity':\n\t\tcase 'pitch-wheel-sens':\n\t\tcase 'pitch-wheel-sensitivity':\n\t\t\t_module._fluid_event_pitch_wheelsens(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.Modulation:\n\t\tcase 'modulation':\n\t\t\t_module._fluid_event_modulation(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.Sustain:\n\t\tcase 'sustain':\n\t\t\t_module._fluid_event_sustain(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.Pan:\n\t\tcase 'pan':\n\t\t\t_module._fluid_event_pan(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.Volume:\n\t\tcase 'volume':\n\t\t\t_module._fluid_event_volume(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.ReverbSend:\n\t\tcase 'reverb':\n\t\tcase 'reverbsend':\n\t\tcase 'reverb-send':\n\t\t\t_module._fluid_event_reverb_send(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.ChorusSend:\n\t\tcase 'chorus':\n\t\tcase 'chorussend':\n\t\tcase 'chorus-send':\n\t\t\t_module._fluid_event_chorus_send(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.KeyPressure:\n\t\tcase 'keypressure':\n\t\tcase 'key-pressure':\n\t\tcase 'aftertouch':\n\t\t\t_module._fluid_event_key_pressure(ev, event.channel, event.key, event.value);\n\t\t\tbreak;\n\t\tcase EventType.ChannelPressure:\n\t\tcase 'channelpressure':\n\t\tcase 'channel-pressure':\n\t\tcase 'channel-aftertouch':\n\t\t\t_module._fluid_event_channel_pressure(ev, event.channel, event.value);\n\t\t\tbreak;\n\t\tcase EventType.SystemReset:\n\t\tcase 'systemreset':\n\t\tcase 'system-reset':\n\t\t\t_module._fluid_event_system_reset(ev);\n\t\t\tbreak;\n\t\tcase EventType.Timer:\n\t\tcase 'timer':\n\t\t\t_module._fluid_event_timer(ev, event.data);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t// 'typeof event' must be 'never' here\n\t\t\treturn false;\n\t}\n\treturn true;\n}\n\n/**\n * Rewrites event data with specified SequencerEvent object.\n * @param data destination instance\n * @param event source data\n * @return true if succeeded\n */\nexport function rewriteEventData(data: ISequencerEventData, event: SequencerEvent): boolean {\n\tif (!data || !(data instanceof SequencerEventData)) {\n\t\treturn false;\n\t}\n\tconst ev = data.getRaw();\n\tif (ev === INVALID_POINTER) {\n\t\treturn false;\n\t}\n\treturn rewriteEventDataImpl(ev, event);\n}\n","\n/** Error object used for errors occurred in the message receiver (e.g. Worklet) */\nexport default class MessageError extends Error {\n\t/** The name of original error object if available */\n\tpublic baseName: any;\n\t/** Detailed properties of original error object if available */\n\tpublic detail: any;\n\n\tconstructor(baseName: string, message: string, detail?: any) {\n\t\tsuper(message);\n\t\tthis.baseName = baseName;\n\t\tthis.detail = detail;\n\t\tif (detail && detail.stack) {\n\t\t\tthis.stack = detail.stack;\n\t\t}\n\t}\n}\n","\nimport IMIDIEvent from './IMIDIEvent';\nimport PointerType, { UniquePointerType } from './PointerType';\n\n/** @internal */\nexport type MIDIEventType = UniquePointerType<'midi_event'>;\n\n/** @internal */\nexport default class MIDIEvent implements IMIDIEvent {\n\n\t/** @internal */\n\tconstructor(private _ptr: MIDIEventType, private _module: any) {\n\t}\n\n\tpublic getType(): number {\n\t\treturn this._module._fluid_midi_event_get_type(this._ptr);\n\t}\n\tpublic setType(value: number): void {\n\t\tthis._module._fluid_midi_event_set_type(this._ptr, value);\n\t}\n\tpublic getChannel(): number {\n\t\treturn this._module._fluid_midi_event_get_channel(this._ptr);\n\t}\n\tpublic setChannel(value: number): void {\n\t\tthis._module._fluid_midi_event_set_channel(this._ptr, value);\n\t}\n\tpublic getKey(): number {\n\t\treturn this._module._fluid_midi_event_get_key(this._ptr);\n\t}\n\tpublic setKey(value: number): void {\n\t\tthis._module._fluid_midi_event_set_key(this._ptr, value);\n\t}\n\tpublic getVelocity(): number {\n\t\treturn this._module._fluid_midi_event_get_velocity(this._ptr);\n\t}\n\tpublic setVelocity(value: number): void {\n\t\tthis._module._fluid_midi_event_set_velocity(this._ptr, value);\n\t}\n\tpublic getControl(): number {\n\t\treturn this._module._fluid_midi_event_get_control(this._ptr);\n\t}\n\tpublic setControl(value: number): void {\n\t\tthis._module._fluid_midi_event_set_control(this._ptr, value);\n\t}\n\tpublic getValue(): number {\n\t\treturn this._module._fluid_midi_event_get_value(this._ptr);\n\t}\n\tpublic setValue(value: number): void {\n\t\tthis._module._fluid_midi_event_set_value(this._ptr, value);\n\t}\n\tpublic getProgram(): number {\n\t\treturn this._module._fluid_midi_event_get_program(this._ptr);\n\t}\n\tpublic setProgram(value: number): void {\n\t\tthis._module._fluid_midi_event_set_program(this._ptr, value);\n\t}\n\tpublic getPitch(): number {\n\t\treturn this._module._fluid_midi_event_get_pitch(this._ptr);\n\t}\n\tpublic setPitch(value: number): void {\n\t\tthis._module._fluid_midi_event_set_pitch(this._ptr, value);\n\t}\n\n\tpublic setSysEx(data: Uint8Array): void {\n\t\tconst size = data.byteLength;\n\t\tconst ptr: PointerType = this._module._malloc(size);\n\t\tconst ptrView = new Uint8Array(this._module.HEAPU8.buffer, ptr, size);\n\t\tptrView.set(data);\n\t\tthis._module._fluid_midi_event_set_sysex(this._ptr, ptr, size, 1);\n\t}\n\tpublic setText(data: Uint8Array): void {\n\t\tconst size = data.byteLength;\n\t\tconst ptr: PointerType = this._module._malloc(size);\n\t\tconst ptrView = new Uint8Array(this._module.HEAPU8.buffer, ptr, size);\n\t\tptrView.set(data);\n\t\tthis._module._fluid_midi_event_set_text(this._ptr, ptr, size, 1);\n\t}\n\tpublic setLyrics(data: Uint8Array): void {\n\t\tconst size = data.byteLength;\n\t\tconst ptr: PointerType = this._module._malloc(size);\n\t\tconst ptrView = new Uint8Array(this._module.HEAPU8.buffer, ptr, size);\n\t\tptrView.set(data);\n\t\tthis._module._fluid_midi_event_set_lyrics(this._ptr, ptr, size, 1);\n\t}\n}\n","\nimport ISequencer, { ClientInfo } from './ISequencer';\nimport ISequencerEventData, { rewriteEventDataImpl } from './ISequencerEventData';\nimport ISynthesizer from './ISynthesizer';\nimport PointerType, { INVALID_POINTER, UniquePointerType } from './PointerType';\nimport SequencerEvent from './SequencerEvent';\nimport SequencerEventData from './SequencerEventData';\nimport { _module, _removeFunction, bindFunctions } from './WasmManager';\n\nimport Synthesizer from './Synthesizer';\n\ntype SequencerPointer = UniquePointerType<'sequencer_ptr'>;\ntype SequencerId = number;\n\nlet bound = false;\nlet fluid_sequencer_get_client_name: (seq: number, id: number) => string;\n\nfunction bindFunctionsForSequencer() {\n\tif (bound) {\n\t\treturn;\n\t}\n\tbindFunctions();\n\tbound = true;\n\n\tfluid_sequencer_get_client_name =\n\t\t_module.cwrap('fluid_sequencer_get_client_name', 'string', ['number', 'number']);\n}\n\nfunction makeEvent(event: SequencerEvent): PointerType | null {\n\tconst ev = _module._new_fluid_event();\n\tif (!rewriteEventDataImpl(ev, event)) {\n\t\t_module._delete_fluid_event(ev);\n\t\treturn null;\n\t}\n\treturn ev;\n}\n\n/** @internal */\nexport default class Sequencer implements ISequencer {\n\n\tprivate _seq: SequencerPointer;\n\tprivate _seqId: SequencerId;\n\n\t/** @internal */\n\tpublic _clientFuncMap: { [id: number]: number };\n\n\tconstructor() {\n\t\tbindFunctionsForSequencer();\n\n\t\tthis._seq = INVALID_POINTER;\n\t\tthis._seqId = -1;\n\t\tthis._clientFuncMap = {};\n\t}\n\n\t/** @internal */\n\tpublic _initialize(): Promise<void> {\n\t\tthis.close();\n\t\tthis._seq = _module._new_fluid_sequencer2(0);\n\t\tthis._seqId = -1;\n\t\treturn Promise.resolve();\n\t}\n\n\t/** @internal */\n\tpublic getRaw() {\n\t\treturn this._seq;\n\t}\n\n\tpublic close() {\n\t\tif (this._seq !== INVALID_POINTER) {\n\t\t\tObject.keys(this._clientFuncMap).forEach((clientIdStr) => {\n\t\t\t\tthis.unregisterClient(Number(clientIdStr));\n\t\t\t});\n\t\t\tthis.unregisterClient(-1);\n\t\t\t_module._delete_fluid_sequencer(this._seq);\n\t\t\tthis._seq = INVALID_POINTER;\n\t\t}\n\t}\n\n\tpublic registerSynthesizer(synth: ISynthesizer | number): Promise<number> {\n\t\tif (this._seqId !== -1) {\n\t\t\t_module._fluid_sequencer_unregister_client(this._seq, this._seqId);\n\t\t\tthis._seqId = -1;\n\t\t}\n\t\tlet val: number;\n\t\tif (typeof synth === 'number') {\n\t\t\tval = synth;\n\t\t} else if (synth instanceof Synthesizer) {\n\t\t\tval = synth.getRawSynthesizer();\n\t\t} else {\n\t\t\treturn Promise.reject(new TypeError('\\'synth\\' is not a compatible type instance'));\n\t\t}\n\n\t\tthis._seqId = _module._fluid_sequencer_register_fluidsynth(this._seq, val);\n\t\treturn Promise.resolve(this._seqId);\n\t}\n\n\tpublic unregisterClient(clientId: number): void {\n\t\tif (clientId === -1) {\n\t\t\tclientId = this._seqId;\n\t\t\tif (clientId === -1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// send 'unregistering' event\n\t\tconst ev = _module._new_fluid_event();\n\t\t_module._fluid_event_set_source(ev, -1);\n\t\t_module._fluid_event_set_dest(ev, clientId);\n\t\t_module._fluid_event_unregistering(ev);\n\t\t_module._fluid_sequencer_send_now(this._seq, ev);\n\t\t_module._delete_fluid_event(ev);\n\n\t\t_module._fluid_sequencer_unregister_client(this._seq, clientId);\n\t\tif (this._seqId === clientId) {\n\t\t\tthis._seqId = -1;\n\t\t} else {\n\t\t\tconst map = this._clientFuncMap;\n\t\t\tif (map[clientId]) {\n\t\t\t\t_removeFunction(map[clientId]);\n\t\t\t\tdelete map[clientId];\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic getAllRegisteredClients(): Promise<ClientInfo[]> {\n\t\tconst c = _module._fluid_sequencer_count_clients(this._seq);\n\t\tconst r: ClientInfo[] = [];\n\t\tfor (let i = 0; i < c; ++i) {\n\t\t\tconst id = _module._fluid_sequencer_get_client_id(this._seq, i);\n\t\t\tconst name = fluid_sequencer_get_client_name(this._seq, id);\n\t\t\tr.push({ clientId: id, name: name });\n\t\t}\n\t\treturn Promise.resolve(r);\n\t}\n\n\tpublic getClientCount(): Promise<number> {\n\t\treturn Promise.resolve<number>(_module._fluid_sequencer_count_clients(this._seq));\n\t}\n\n\tpublic getClientInfo(index: number): Promise<ClientInfo> {\n\t\tconst id = _module._fluid_sequencer_get_client_id(this._seq, index);\n\t\tconst name = fluid_sequencer_get_client_name(this._seq, id);\n\t\treturn Promise.resolve<ClientInfo>({ clientId: id, name: name });\n\t}\n\n\tpublic setTimeScale(scale: number): void {\n\t\t_module._fluid_sequencer_set_time_scale(this._seq, scale);\n\t}\n\n\tpublic getTimeScale(): Promise<number> {\n\t\treturn Promise.resolve(_module._fluid_sequencer_get_time_scale(this._seq));\n\t}\n\n\tpublic getTick(): Promise<number> {\n\t\treturn Promise.resolve(_module._fluid_sequencer_get_tick(this._seq));\n\t}\n\n\tpublic sendEventAt(event: SequencerEvent, tick: number, isAbsolute: boolean): void {\n\t\tconst ev = makeEvent(event);\n\t\tif (ev !== null) {\n\t\t\t// send to all clients\n\t\t\tconst count = _module._fluid_sequencer_count_clients(this._seq);\n\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\tconst id: number = _module._fluid_sequencer_get_client_id(this._seq, i);\n\t\t\t\t_module._fluid_event_set_dest(ev, id);\n\t\t\t\t_module._fluid_sequencer_send_at(this._seq, ev, tick, isAbsolute ? 1 : 0);\n\t\t\t}\n\t\t\t_module._delete_fluid_event(ev);\n\t\t}\n\t}\n\n\tpublic sendEventToClientAt(clientId: number, event: SequencerEvent, tick: number, isAbsolute: boolean): void {\n\t\tconst ev = makeEvent(event);\n\t\tif (ev !== null) {\n\t\t\t_module._fluid_event_set_dest(ev, clientId === -1 ? this._seqId : clientId);\n\t\t\t_module._fluid_sequencer_send_at(this._seq, ev, tick, isAbsolute ? 1 : 0);\n\t\t\t_module._delete_fluid_event(ev);\n\t\t}\n\t}\n\n\t/** @internal */\n\tpublic sendEventToClientNow(clientId: number, event: SequencerEvent): void {\n\t\tconst ev = makeEvent(event);\n\t\tif (ev !== null) {\n\t\t\t_module._fluid_event_set_dest(ev, clientId === -1 ? this._seqId : clientId);\n\t\t\t_module._fluid_sequencer_send_now(this._seq, ev);\n\t\t\t_module._delete_fluid_event(ev);\n\t\t}\n\t}\n\n\t/** @internal */\n\tpublic sendEventNow(clientId: number, eventData: ISequencerEventData): void {\n\t\tif (!(eventData instanceof SequencerEventData)) {\n\t\t\treturn;\n\t\t}\n\t\tconst ev = eventData.getRaw();\n\t\tif (ev !== INVALID_POINTER) {\n\t\t\t_module._fluid_event_set_dest(ev, clientId === -1 ? this._seqId : clientId);\n\t\t\t_module._fluid_sequencer_send_now(this._seq, ev);\n\t\t}\n\t}\n\n\tpublic removeAllEvents(): void {\n\t\t_module._fluid_sequencer_remove_events(this._seq, -1, -1, -1);\n\t}\n\n\tpublic removeAllEventsFromClient(clientId: number): void {\n\t\t_module._fluid_sequencer_remove_events(this._seq, -1, clientId === -1 ? this._seqId : clientId, -1);\n\t}\n\n\tpublic processSequencer(msecToProcess: number) {\n\t\tif (this._seq !== INVALID_POINTER) {\n\t\t\t_module._fluid_sequencer_process(this._seq, msecToProcess);\n\t\t}\n\t}\n\n\t/** @internal */\n\tpublic setIntervalForSequencer(msec: number) {\n\t\treturn setInterval(() => this.processSequencer(msec), msec);\n\t}\n}\n","import { INVALID_POINTER, UniquePointerType } from './PointerType';\nimport Preset from './Preset';\nimport Synthesizer from './Synthesizer';\nimport { _module, bindFunctions } from './WasmManager';\n\ntype SFontPointer = UniquePointerType<'sfont_ptr'>;\ntype PresetPointer = UniquePointerType<'preset_ptr'>;\n\nlet bound = false;\nlet fluid_sfont_get_name: (sfont: SFontPointer) => string;\nlet fluid_preset_get_name: (preset: PresetPointer) => string;\n\nfunction bindFunctionsForSoundfont() {\n\tif (bound) {\n\t\treturn;\n\t}\n\tbindFunctions();\n\tbound = true;\n\n\tfluid_sfont_get_name =\n\t\t_module.cwrap('fluid_sfont_get_name', 'string', ['number']);\n\tfluid_preset_get_name =\n\t\t_module.cwrap('fluid_preset_get_name', 'string', ['number']);\n}\n\nexport default class Soundfont {\n\tprivate readonly _ptr: SFontPointer;\n\n\t// @internal\n\tpublic constructor(sfontPtr: SFontPointer) {\n\t\tthis._ptr = sfontPtr;\n\t}\n\n\tpublic static getSoundfontById(synth: Synthesizer, id: number): Soundfont | null {\n\t\tbindFunctionsForSoundfont();\n\n\t\tconst sfont = _module._fluid_synth_get_sfont_by_id(synth.getRawSynthesizer(), id);\n\t\tif (sfont === INVALID_POINTER) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new Soundfont(sfont);\n\t}\n\n\tpublic getName(): string {\n\t\treturn fluid_sfont_get_name(this._ptr);\n\t}\n\n\tpublic getPreset(bank: number, presetNum: number): Preset | null {\n\t\tconst presetPtr: PresetPointer = _module._fluid_sfont_get_preset(this._ptr, bank, presetNum);\n\t\tif (presetPtr === INVALID_POINTER) {\n\t\t\treturn null;\n\t\t}\n\t\tconst name = fluid_preset_get_name(presetPtr);\n\t\tconst bankNum = _module._fluid_preset_get_banknum(presetPtr);\n\t\tconst num = _module._fluid_preset_get_num(presetPtr);\n\t\treturn {\n\t\t\tsoundfont: this,\n\t\t\tname,\n\t\t\tbankNum,\n\t\t\tnum\n\t\t};\n\t}\n\n\tpublic getPresetIterable(): Iterable<Preset> {\n\t\tconst reset = () => {\n\t\t\t_module._fluid_sfont_iteration_start(this._ptr);\n\t\t};\n\t\tconst next = (): IteratorResult<Preset, void> => {\n\t\t\tconst presetPtr = _module._fluid_sfont_iteration_next(this._ptr);\n\t\t\tif (presetPtr === 0) {\n\t\t\t\treturn {\n\t\t\t\t\tdone: true,\n\t\t\t\t\tvalue: undefined\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconst name = fluid_preset_get_name(presetPtr);\n\t\t\t\tconst bankNum = _module._fluid_preset_get_banknum(presetPtr);\n\t\t\t\tconst num = _module._fluid_preset_get_num(presetPtr);\n\t\t\t\treturn {\n\t\t\t\t\tdone: false,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tsoundfont: this,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tbankNum,\n\t\t\t\t\t\tnum\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tconst iterator = (): Iterator<Preset> => {\n\t\t\treset();\n\t\t\treturn {\n\t\t\t\tnext,\n\t\t\t};\n\t\t};\n\t\treturn {\n\t\t\t[Symbol.iterator]: iterator,\n\t\t};\n\t}\n}\n","import { _module, bindFunctions } from './WasmManager';\n\nlet _ptrDefaultLogFunction: number | undefined;\nlet _disabledLoggingLevel: LogLevel | null = null;\nconst _handlers: Array<(level: LogLevel | null) => void> = [];\n\nconst LOG_LEVEL_COUNT = 5;\n/** Log level for libfluidsynth */\nconst LogLevel = {\n\tPanic: 0,\n\tError: 1,\n\tWarning: 2,\n\tInfo: 3,\n\tDebug: 4,\n} as const;\n/** Log level for libfluidsynth */\ntype LogLevel = (typeof LogLevel)[keyof typeof LogLevel];\nexport { LogLevel };\n\n/**\n * Disable log output from libfluidsynth.\n * @param level disable log level (when `LogLevel.Warning` is specified, `Warning` `Info` `Debug` is disabled)\n * - If `null` is specified, log output feature is restored to the default.\n */\nexport function disableLogging(level: LogLevel | null = LogLevel.Panic): void {\n\tif (_disabledLoggingLevel === level) {\n\t\treturn;\n\t}\n\tbindFunctions();\n\tif (level == null) {\n\t\tif (_ptrDefaultLogFunction != null) {\n\t\t\t_module._fluid_set_log_function(0, _ptrDefaultLogFunction, 0);\n\t\t\t_module._fluid_set_log_function(1, _ptrDefaultLogFunction, 0);\n\t\t\t_module._fluid_set_log_function(2, _ptrDefaultLogFunction, 0);\n\t\t\t_module._fluid_set_log_function(3, _ptrDefaultLogFunction, 0);\n\t\t}\n\t\t_module._fluid_set_log_function(4, 0, 0);\n\t} else {\n\t\tlet ptr: number | undefined;\n\t\tfor (let l = level; l < LOG_LEVEL_COUNT; ++l) {\n\t\t\tconst p = _module._fluid_set_log_function(l, 0, 0);\n\t\t\tif (l !== LogLevel.Debug) {\n\t\t\t\tptr = p;\n\t\t\t}\n\t\t}\n\t\tif (ptr != null && _ptrDefaultLogFunction == null) {\n\t\t\t_ptrDefaultLogFunction = ptr;\n\t\t}\n\t}\n\t_disabledLoggingLevel = level;\n\tfor (const fn of _handlers) {\n\t\tfn(level);\n\t}\n}\n\n/**\n * Restores the log output from libfluidsynth. Same for calling `disableLogging(null)`.\n */\nexport function restoreLogging(): void {\n\tdisableLogging(null);\n}\n\n// @internal\nexport function getDisabledLoggingLevel(): LogLevel | null {\n\treturn _disabledLoggingLevel;\n}\n\n// @internal\nexport function addLoggingStatusChangedHandler(\n\tfn: (level: LogLevel | null) => void\n): void {\n\t_handlers.push(fn);\n}\n\n// @internal\nexport function removeLoggingStatusChangedHandler(\n\tfn: (level: LogLevel | null) => void\n): void {\n\tfor (let i = 0; i < _handlers.length; ++i) {\n\t\tif (_handlers[i] === fn) {\n\t\t\t_handlers.splice(i, 1);\n\t\t\treturn;\n\t\t}\n\t}\n}\n","\nimport {\n\tSynthesizerDefaultValues,\n\tInterpolationValues,\n\tChorusModulation,\n\tGeneratorTypes,\n\tLegatoMode,\n\tPortamentoMode,\n\tPlayerSetTempoType,\n} from './Constants';\nimport IMIDIEvent from './IMIDIEvent';\nimport ISequencer from './ISequencer';\nimport ISequencerEventData from './ISequencerEventData';\nimport ISynthesizer from './ISynthesizer';\nimport PointerType, { INVALID_POINTER } from './PointerType';\nimport SynthesizerSettings from './SynthesizerSettings';\nimport {\n\tPlayerId,\n\tSettingsId,\n\tSynthId,\n\t_addFunction,\n\t_fs,\n\t_module,\n\t_removeFunction,\n\tbindFunctions,\n\tdefaultMIDIEventCallback,\n\tfluid_sequencer_register_client,\n\tfluid_settings_setint,\n\tfluid_settings_setnum,\n\tfluid_settings_setstr,\n\tfluid_synth_error,\n\tfluid_synth_sfload,\n\tmalloc,\n\tfree,\n\twaitForInitialized,\n} from './WasmManager';\n\nimport MIDIEvent, { MIDIEventType } from './MIDIEvent';\nimport Sequencer from './Sequencer';\nimport SequencerEvent, { EventType as SequencerEventType } from './SequencerEvent';\nimport SequencerEventData from './SequencerEventData';\nimport Soundfont from './Soundfont';\n\nfunction setBoolValueForSettings(settings: SettingsId, name: string, value: boolean | undefined) {\n\tif (typeof value !== 'undefined') {\n\t\tfluid_settings_setint(settings, name, value ? 1 : 0);\n\t}\n}\nfunction setIntValueForSettings(settings: SettingsId, name: string, value: number | undefined) {\n\tif (typeof value !== 'undefined') {\n\t\tfluid_settings_setint(settings, name, value);\n\t}\n}\nfunction setNumValueForSettings(settings: SettingsId, name: string, value: number | undefined) {\n\tif (typeof value !== 'undefined') {\n\t\tfluid_settings_setnum(settings, name, value);\n\t}\n}\nfunction setStrValueForSettings(settings: SettingsId, name: string, value: string | undefined) {\n\tif (typeof value !== 'undefined') {\n\t\tfluid_settings_setstr(settings, name, value);\n\t}\n}\n\nfunction getActiveVoiceCount(synth: SynthId): number {\n\tconst actualCount = _module._fluid_synth_get_active_voice_count(synth);\n\tif (!actualCount) {\n\t\treturn 0;\n\t}\n\n\t// FluidSynth may return incorrect value for active voice count,\n\t// so check internal data and correct it\n\n\t// check if the structure is not changed\n\t// for fluidsynth 2.0.x-2.1.x:\n\t//   140 === offset [synth->voice]\n\t//   144 === offset [synth->active_voice_count] for \n\t// for fluidsynth 2.2.x:\n\t//   144 === offset [synth->voice]\n\t//   148 === offset [synth->active_voice_count]\n\t// first check 2.1.x structure\n\tlet baseOffsetOfVoice = 140;\n\tlet offsetOfActiveVoiceCount = (synth + baseOffsetOfVoice + 4) >> 2;\n\tlet structActiveVoiceCount = _module.HEAPU32[offsetOfActiveVoiceCount];\n\tif (structActiveVoiceCount !== actualCount) {\n\t\t// add 4 for 2.2.x\n\t\tbaseOffsetOfVoice += 4;\n\t\toffsetOfActiveVoiceCount = (synth + baseOffsetOfVoice + 4) >> 2;\n\t\tstructActiveVoiceCount = _module.HEAPU32[offsetOfActiveVoiceCount];\n\t\tif (structActiveVoiceCount !== actualCount) {\n\t\t\t// unknown structure\n\t\t\tconst c = console;\n\t\t\tc.warn(\n\t\t\t\t'js-synthesizer: cannot check synthesizer internal data (may be changed)'\n\t\t\t);\n\t\t\treturn actualCount;\n\t\t}\n\t}\n\n\tconst voiceList = _module.HEAPU32[(synth + baseOffsetOfVoice) >> 2];\n\t// (voice should not be NULL)\n\tif (!voiceList || voiceList >= _module.HEAPU32.byteLength) {\n\t\t// unknown structure\n\t\tconst c = console;\n\t\tc.warn(\n\t\t\t'js-synthesizer: cannot check synthesizer internal data (may be changed)'\n\t\t);\n\t\treturn actualCount;\n\t}\n\n\t// count of internal voice data is restricted to polyphony value\n\tconst voiceCount = _module._fluid_synth_get_polyphony(synth);\n\tlet isRunning = false;\n\tfor (let i = 0; i < voiceCount; ++i) {\n\t\t// auto voice = voiceList[i]\n\t\tconst voice = _module.HEAPU32[(voiceList >> 2) + i];\n\t\tif (!voice) {\n\t\t\tcontinue;\n\t\t}\n\t\t// offset [voice->status]\n\t\tconst status = _module.HEAPU8[voice + 4];\n\t\t// 4: FLUID_VOICE_OFF\n\t\tif (status !== 4) {\n\t\t\tisRunning = true;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (!isRunning) {\n\t\tif (structActiveVoiceCount !== 0) {\n\t\t\tconst c = console;\n\t\t\tc.warn(\n\t\t\t\t'js-synthesizer: Active voice count is not zero, but all voices are off:',\n\t\t\t\tstructActiveVoiceCount,\n\t\t\t);\n\t\t}\n\t\t_module.HEAPU32[offsetOfActiveVoiceCount] = 0;\n\t\treturn 0;\n\t}\n\n\treturn actualCount;\n}\n\nfunction makeRandomFileName(type: string, ext: string) {\n\treturn `/${type}-r${Math.random() * 65535}-${Math.random() * 65535}${ext}`;\n}\n\n/** Hook callback function type */\nexport interface HookMIDIEventCallback {\n\t/**\n\t * Hook callback function type.\n\t * @param synth the base synthesizer instance\n\t * @param eventType MIDI event type (e.g. 0x90 is note-on event)\n\t * @param eventData detailed event data\n\t * @param param parameter data passed to the registration method\n\t * @return true if the event data is processed, or false if the default processing is necessary\n\t */\n\t(synth: Synthesizer, eventType: number, eventData: IMIDIEvent, param: any): boolean;\n}\n\n/** Client callback function type for sequencer object */\nexport interface SequencerClientCallback {\n\t/**\n\t * Client callback function type for sequencer object.\n\t * @param time the sequencer tick value\n\t * @param eventType sequencer event type\n\t * @param event actual event data (can only be used in this callback function)\n\t * @param sequencer the base sequencer object\n\t * @param param parameter data passed to the registration method\n\t */\n\t(time: number, eventType: SequencerEventType, event: ISequencerEventData, sequencer: ISequencer, param: number): void;\n}\n\nfunction makeMIDIEventCallback(synth: Synthesizer, cb: HookMIDIEventCallback, param: any) {\n\treturn (data: PointerType, event: MIDIEventType): number => {\n\t\tconst t = _module._fluid_midi_event_get_type(event);\n\t\tif (cb(synth, t, new MIDIEvent(event, _module), param)) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn _module._fluid_synth_handle_midi_event(data, event);\n\t};\n}\n\n/** Default implementation of ISynthesizer */\nexport default class Synthesizer implements ISynthesizer {\n\t/** @internal */\n\tprivate _settings: SettingsId;\n\t/** @internal */\n\tprivate _synth: SynthId;\n\t/** @internal */\n\tprivate _player: PlayerId;\n\t/** @internal */\n\tprivate _playerPlaying: boolean;\n\t/** @internal */\n\tprivate _playerDefer:\n\t\t| undefined\n\t\t| {\n\t\t\t\tpromise: Promise<void>;\n\t\t\t\tresolve: () => void;\n\t\t  };\n\t/** @internal */\n\tprivate _playerCallbackPtr: number | null;\n\t/** @internal */\n\tprivate _fluidSynthCallback: PointerType | null;\n\n\t/** @internal */\n\tprivate _buffer: PointerType;\n\t/** @internal */\n\tprivate _bufferSize: number;\n\t/** @internal */\n\tprivate _numPtr: PointerType;\n\n\t/** @internal */\n\tprivate _gain: number;\n\n\tconstructor() {\n\t\tbindFunctions();\n\n\t\tthis._settings = INVALID_POINTER;\n\t\tthis._synth = INVALID_POINTER;\n\t\tthis._player = INVALID_POINTER;\n\t\tthis._playerPlaying = false;\n\t\tthis._playerCallbackPtr = null;\n\t\tthis._fluidSynthCallback = null;\n\n\t\tthis._buffer = INVALID_POINTER;\n\t\tthis._bufferSize = 0;\n\t\tthis._numPtr = INVALID_POINTER;\n\n\t\tthis._gain = SynthesizerDefaultValues.Gain;\n\t}\n\n\t/**\n\t * Initializes with loaded FluidSynth module.\n\t * If using this method, you must call this before all methods/constructors, including `waitForWasmInitialized`.\n\t * @param mod loaded libfluidsynth.js instance (typically `const mod = Module` (loaded via script tag) or `const mod = require('libfluidsynth-*.js')` (in Node.js))\n\t */\n\tpublic static initializeWithFluidSynthModule(mod: unknown): void {\n\t\tbindFunctions(mod);\n\t}\n\n\t/** Return the promise object that resolves when WebAssembly has been initialized. */\n\tpublic static waitForWasmInitialized(): Promise<void> {\n\t\treturn waitForInitialized();\n\t}\n\n\tpublic isInitialized() {\n\t\treturn this._synth !== INVALID_POINTER;\n\t}\n\n\t/** Return the raw synthesizer instance value (pointer for libfluidsynth). */\n\tpublic getRawSynthesizer(): number {\n\t\treturn this._synth;\n\t}\n\n\tpublic createAudioNode(\n\t\tcontext: AudioContext,\n\t\tframeSize?: number\n\t): AudioNode {\n\t\tconst node = context.createScriptProcessor(frameSize, 0, 2);\n\t\tnode.addEventListener(\"audioprocess\", (ev) => {\n\t\t\tthis.render(ev.outputBuffer);\n\t\t});\n\t\treturn node;\n\t}\n\n\tpublic init(sampleRate: number, settings?: SynthesizerSettings) {\n\t\tthis.close();\n\n\t\tconst set = (this._settings = _module._new_fluid_settings());\n\t\tfluid_settings_setnum(set, \"synth.sample-rate\", sampleRate);\n\t\tif (settings) {\n\t\t\tif (typeof settings.initialGain !== \"undefined\") {\n\t\t\t\tthis._gain = settings.initialGain;\n\t\t\t}\n\t\t\tsetBoolValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.chorus.active\",\n\t\t\t\tsettings.chorusActive\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.chorus.depth\",\n\t\t\t\tsettings.chorusDepth\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.chorus.level\",\n\t\t\t\tsettings.chorusLevel\n\t\t\t);\n\t\t\tsetIntValueForSettings(set, \"synth.chorus.nr\", settings.chorusNr);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.chorus.speed\",\n\t\t\t\tsettings.chorusSpeed\n\t\t\t);\n\t\t\tsetIntValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.midi-channels\",\n\t\t\t\tsettings.midiChannelCount\n\t\t\t);\n\t\t\tsetStrValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.midi-bank-select\",\n\t\t\t\tsettings.midiBankSelect\n\t\t\t);\n\t\t\tsetIntValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.min-note-length\",\n\t\t\t\tsettings.minNoteLength\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.overflow.age\",\n\t\t\t\tsettings.overflowAge\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.overflow.important\",\n\t\t\t\tsettings.overflowImportantValue\n\t\t\t);\n\t\t\tif (typeof settings.overflowImportantChannels !== \"undefined\") {\n\t\t\t\tfluid_settings_setstr(\n\t\t\t\t\tset,\n\t\t\t\t\t\"synth.overflow.important-channels\",\n\t\t\t\t\tsettings.overflowImportantChannels.join(\",\")\n\t\t\t\t);\n\t\t\t}\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.overflow.percussion\",\n\t\t\t\tsettings.overflowPercussion\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.overflow.released\",\n\t\t\t\tsettings.overflowReleased\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.overflow.sustained\",\n\t\t\t\tsettings.overflowSustained\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.overflow.volume\",\n\t\t\t\tsettings.overflowVolume\n\t\t\t);\n\t\t\tsetIntValueForSettings(set, \"synth.polyphony\", settings.polyphony);\n\t\t\tsetBoolValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.reverb.active\",\n\t\t\t\tsettings.reverbActive\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.reverb.damp\",\n\t\t\t\tsettings.reverbDamp\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.reverb.level\",\n\t\t\t\tsettings.reverbLevel\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.reverb.room-size\",\n\t\t\t\tsettings.reverbRoomSize\n\t\t\t);\n\t\t\tsetNumValueForSettings(\n\t\t\t\tset,\n\t\t\t\t\"synth.reverb.width\",\n\t\t\t\tsettings.reverbWidth\n\t\t\t);\n\t\t}\n\t\tfluid_settings_setnum(set, \"synth.gain\", this._gain);\n\n\t\tthis._synth = _module._new_fluid_synth(this._settings);\n\n\t\tthis._numPtr = malloc(8);\n\t}\n\n\tpublic close() {\n\t\tif (this._synth === INVALID_POINTER) {\n\t\t\treturn;\n\t\t}\n\t\tthis._closePlayer();\n\t\t_module._delete_fluid_synth(this._synth);\n\t\tthis._synth = INVALID_POINTER;\n\t\t_module._delete_fluid_settings(this._settings);\n\t\tthis._settings = INVALID_POINTER;\n\t\tfree(this._numPtr);\n\t\tthis._numPtr = INVALID_POINTER;\n\t}\n\n\tpublic isPlaying() {\n\t\treturn (\n\t\t\tthis._synth !== INVALID_POINTER &&\n\t\t\tgetActiveVoiceCount(this._synth) > 0\n\t\t);\n\t}\n\n\tpublic setInterpolation(value: InterpolationValues, channel?: number) {\n\t\tthis.ensureInitialized();\n\t\tif (typeof channel === \"undefined\") {\n\t\t\tchannel = -1;\n\t\t}\n\t\t_module._fluid_synth_set_interp_method(this._synth, channel, value);\n\t}\n\n\tpublic getGain() {\n\t\treturn this._gain;\n\t}\n\n\tpublic setGain(gain: number) {\n\t\tthis.ensureInitialized();\n\t\t_module._fluid_synth_set_gain(this._synth, gain);\n\t\tthis._gain = _module._fluid_synth_get_gain(this._synth);\n\t}\n\n\tpublic setChannelType(channel: number, isDrum: boolean) {\n\t\tthis.ensureInitialized();\n\t\t// CHANNEL_TYPE_MELODIC = 0, CHANNEL_TYPE_DRUM = 1\n\t\t_module._fluid_synth_set_channel_type(\n\t\t\tthis._synth,\n\t\t\tchannel,\n\t\t\tisDrum ? 1 : 0\n\t\t);\n\t}\n\n\tpublic waitForVoicesStopped() {\n\t\treturn this.flushFramesAsync();\n\t}\n\n\tpublic loadSFont(bin: ArrayBuffer) {\n\t\tthis.ensureInitialized();\n\n\t\tconst name = makeRandomFileName(\"sfont\", \".sf2\");\n\t\tconst ub = new Uint8Array(bin);\n\n\t\t_fs.writeFile(name, ub);\n\t\tconst sfont = fluid_synth_sfload(this._synth, name, 1);\n\t\t_fs.unlink(name);\n\t\treturn sfont === -1\n\t\t\t? Promise.reject(new Error(fluid_synth_error!(this._synth)))\n\t\t\t: Promise.resolve(sfont);\n\t}\n\n\tpublic unloadSFont(id: number) {\n\t\tthis.ensureInitialized();\n\t\tthis.stopPlayer();\n\t\tthis.flushFramesSync();\n\n\t\t_module._fluid_synth_sfunload(this._synth, id, 1);\n\t}\n\n\tpublic unloadSFontAsync(id: number) {\n\t\t// not throw with Promise.reject\n\t\tthis.ensureInitialized();\n\t\tthis.stopPlayer();\n\t\treturn this.flushFramesAsync().then(() => {\n\t\t\t_module._fluid_synth_sfunload(this._synth, id, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Returns the `Soundfont` instance for specified SoundFont.\n\t * @param sfontId loaded SoundFont id ({@link loadSFont} returns this)\n\t * @return `Soundfont` instance or `null` if `sfontId` is not valid or loaded\n\t */\n\tpublic getSFontObject(sfontId: number): Soundfont | null {\n\t\treturn Soundfont.getSoundfontById(this, sfontId);\n\t}\n\n\tpublic getSFontBankOffset(id: number) {\n\t\tthis.ensureInitialized();\n\t\treturn Promise.resolve(\n\t\t\t_module._fluid_synth_get_bank_offset(this._synth, id) as number\n\t\t);\n\t}\n\tpublic setSFontBankOffset(id: number, offset: number) {\n\t\tthis.ensureInitialized();\n\t\t_module._fluid_synth_set_bank_offset(this._synth, id, offset);\n\t}\n\n\tpublic render(outBuffer: AudioBuffer | Float32Array[]) {\n\t\tconst frameCount =\n\t\t\t\"numberOfChannels\" in outBuffer\n\t\t\t\t? outBuffer.length\n\t\t\t\t: outBuffer[0].length;\n\t\tconst channels =\n\t\t\t\"numberOfChannels\" in outBuffer\n\t\t\t\t? outBuffer.numberOfChannels\n\t\t\t\t: outBuffer.length;\n\t\tconst sizePerChannel = 4 * frameCount;\n\t\tconst totalSize = sizePerChannel * 2;\n\t\tif (this._bufferSize < totalSize) {\n\t\t\tif (this._buffer !== INVALID_POINTER) {\n\t\t\t\tfree(this._buffer);\n\t\t\t}\n\t\t\tthis._buffer = malloc(totalSize);\n\t\t\tthis._bufferSize = totalSize;\n\t\t}\n\n\t\tconst memLeft = this._buffer;\n\t\tconst memRight = ((this._buffer as number) +\n\t\t\tsizePerChannel) as PointerType;\n\t\tthis.renderRaw(memLeft, memRight, frameCount);\n\n\t\tconst aLeft = new Float32Array(\n\t\t\t_module.HEAPU8.buffer,\n\t\t\tmemLeft,\n\t\t\tframeCount\n\t\t);\n\t\tconst aRight =\n\t\t\tchannels >= 2\n\t\t\t\t? new Float32Array(_module.HEAPU8.buffer, memRight, frameCount)\n\t\t\t\t: null;\n\t\tif (\"numberOfChannels\" in outBuffer) {\n\t\t\tif (outBuffer.copyToChannel) {\n\t\t\t\toutBuffer.copyToChannel(aLeft, 0, 0);\n\t\t\t\tif (aRight) {\n\t\t\t\t\toutBuffer.copyToChannel(aRight, 1, 0);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// copyToChannel API not exist in Safari AudioBuffer\n\t\t\t\tconst leftData = outBuffer.getChannelData(0);\n\t\t\t\taLeft.forEach((val, i) => (leftData[i] = val));\n\t\t\t\tif (aRight) {\n\t\t\t\t\tconst rightData = outBuffer.getChannelData(1);\n\t\t\t\t\taRight.forEach((val, i) => (rightData[i] = val));\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\toutBuffer[0].set(aLeft);\n\t\t\tif (aRight) {\n\t\t\t\toutBuffer[1].set(aRight);\n\t\t\t}\n\t\t}\n\n\t\t// check and update player status\n\t\tthis.isPlayerPlaying();\n\t}\n\n\tpublic midiNoteOn(chan: number, key: number, vel: number) {\n\t\t_module._fluid_synth_noteon(this._synth, chan, key, vel);\n\t}\n\tpublic midiNoteOff(chan: number, key: number) {\n\t\t_module._fluid_synth_noteoff(this._synth, chan, key);\n\t}\n\tpublic midiKeyPressure(chan: number, key: number, val: number) {\n\t\t_module._fluid_synth_key_pressure(this._synth, chan, key, val);\n\t}\n\tpublic midiControl(chan: number, ctrl: number, val: number) {\n\t\t_module._fluid_synth_cc(this._synth, chan, ctrl, val);\n\t}\n\tpublic midiProgramChange(chan: number, prognum: number) {\n\t\t_module._fluid_synth_program_change(this._synth, chan, prognum);\n\t}\n\tpublic midiChannelPressure(chan: number, val: number) {\n\t\t_module._fluid_synth_channel_pressure(this._synth, chan, val);\n\t}\n\tpublic midiPitchBend(chan: number, val: number) {\n\t\t_module._fluid_synth_pitch_bend(this._synth, chan, val);\n\t}\n\tpublic midiSysEx(data: Uint8Array) {\n\t\tconst len = data.byteLength;\n\t\tconst mem = malloc(len);\n\t\t_module.HEAPU8.set(data, mem);\n\t\t_module._fluid_synth_sysex(\n\t\t\tthis._synth,\n\t\t\tmem,\n\t\t\tlen,\n\t\t\tINVALID_POINTER,\n\t\t\tINVALID_POINTER,\n\t\t\tINVALID_POINTER,\n\t\t\t0\n\t\t);\n\t\tfree(mem);\n\t}\n\n\tpublic midiPitchWheelSensitivity(chan: number, val: number) {\n\t\t_module._fluid_synth_pitch_wheel_sens(this._synth, chan, val);\n\t}\n\tpublic midiBankSelect(chan: number, bank: number) {\n\t\t_module._fluid_synth_bank_select(this._synth, chan, bank);\n\t}\n\tpublic midiSFontSelect(chan: number, sfontId: number) {\n\t\t_module._fluid_synth_sfont_select(this._synth, chan, sfontId);\n\t}\n\tpublic midiProgramSelect(\n\t\tchan: number,\n\t\tsfontId: number,\n\t\tbank: number,\n\t\tpresetNum: number\n\t) {\n\t\t_module._fluid_synth_program_select(\n\t\t\tthis._synth,\n\t\t\tchan,\n\t\t\tsfontId,\n\t\t\tbank,\n\t\t\tpresetNum\n\t\t);\n\t}\n\tpublic midiUnsetProgram(chan: number) {\n\t\t_module._fluid_synth_unset_program(this._synth, chan);\n\t}\n\tpublic midiProgramReset() {\n\t\t_module._fluid_synth_program_reset(this._synth);\n\t}\n\tpublic midiSystemReset() {\n\t\t_module._fluid_synth_system_reset(this._synth);\n\t}\n\tpublic midiAllNotesOff(chan?: number) {\n\t\t_module._fluid_synth_all_notes_off(\n\t\t\tthis._synth,\n\t\t\ttypeof chan === \"undefined\" ? -1 : chan\n\t\t);\n\t}\n\tpublic midiAllSoundsOff(chan?: number) {\n\t\t_module._fluid_synth_all_sounds_off(\n\t\t\tthis._synth,\n\t\t\ttypeof chan === \"undefined\" ? -1 : chan\n\t\t);\n\t}\n\tpublic midiSetChannelType(chan: number, isDrum: boolean) {\n\t\t// CHANNEL_TYPE_MELODIC = 0\n\t\t// CHANNEL_TYPE_DRUM = 1\n\t\t_module._fluid_synth_set_channel_type(\n\t\t\tthis._synth,\n\t\t\tchan,\n\t\t\tisDrum ? 1 : 0\n\t\t);\n\t}\n\n\t/**\n\t * Set reverb parameters to the synthesizer.\n\t */\n\tpublic setReverb(\n\t\troomsize: number,\n\t\tdamping: number,\n\t\twidth: number,\n\t\tlevel: number\n\t) {\n\t\t_module._fluid_synth_set_reverb(\n\t\t\tthis._synth,\n\t\t\troomsize,\n\t\t\tdamping,\n\t\t\twidth,\n\t\t\tlevel\n\t\t);\n\t}\n\t/**\n\t * Set reverb roomsize parameter to the synthesizer.\n\t */\n\tpublic setReverbRoomsize(roomsize: number) {\n\t\t_module._fluid_synth_set_reverb_roomsize(this._synth, roomsize);\n\t}\n\t/**\n\t * Set reverb damping parameter to the synthesizer.\n\t */\n\tpublic setReverbDamp(damping: number) {\n\t\t_module._fluid_synth_set_reverb_damp(this._synth, damping);\n\t}\n\t/**\n\t * Set reverb width parameter to the synthesizer.\n\t */\n\tpublic setReverbWidth(width: number) {\n\t\t_module._fluid_synth_set_reverb_width(this._synth, width);\n\t}\n\t/**\n\t * Set reverb level to the synthesizer.\n\t */\n\tpublic setReverbLevel(level: number) {\n\t\t_module._fluid_synth_set_reverb_level(this._synth, level);\n\t}\n\t/**\n\t * Enable or disable reverb effect of the synthesizer.\n\t */\n\tpublic setReverbOn(on: boolean) {\n\t\t_module._fluid_synth_set_reverb_on(this._synth, on ? 1 : 0);\n\t}\n\t/**\n\t * Get reverb roomsize parameter of the synthesizer.\n\t */\n\tpublic getReverbRoomsize(): number {\n\t\treturn _module._fluid_synth_get_reverb_roomsize(this._synth);\n\t}\n\t/**\n\t * Get reverb damping parameter of the synthesizer.\n\t */\n\tpublic getReverbDamp(): number {\n\t\treturn _module._fluid_synth_get_reverb_damp(this._synth);\n\t}\n\t/**\n\t * Get reverb level of the synthesizer.\n\t */\n\tpublic getReverbLevel(): number {\n\t\treturn _module._fluid_synth_get_reverb_level(this._synth);\n\t}\n\t/**\n\t * Get reverb width parameter of the synthesizer.\n\t */\n\tpublic getReverbWidth(): number {\n\t\treturn _module._fluid_synth_get_reverb_width(this._synth);\n\t}\n\n\t/**\n\t * Set chorus parameters to the synthesizer.\n\t */\n\tpublic setChorus(\n\t\tvoiceCount: number,\n\t\tlevel: number,\n\t\tspeed: number,\n\t\tdepthMillisec: number,\n\t\ttype: ChorusModulation\n\t) {\n\t\t_module._fluid_synth_set_chorus(\n\t\t\tthis._synth,\n\t\t\tvoiceCount,\n\t\t\tlevel,\n\t\t\tspeed,\n\t\t\tdepthMillisec,\n\t\t\ttype\n\t\t);\n\t}\n\t/**\n\t * Set chorus voice count parameter to the synthesizer.\n\t */\n\tpublic setChorusVoiceCount(voiceCount: number) {\n\t\t_module._fluid_synth_set_chorus_nr(this._synth, voiceCount);\n\t}\n\t/**\n\t * Set chorus level parameter to the synthesizer.\n\t */\n\tpublic setChorusLevel(level: number) {\n\t\t_module._fluid_synth_set_chorus_level(this._synth, level);\n\t}\n\t/**\n\t * Set chorus speed parameter to the synthesizer.\n\t */\n\tpublic setChorusSpeed(speed: number) {\n\t\t_module._fluid_synth_set_chorus_speed(this._synth, speed);\n\t}\n\t/**\n\t * Set chorus depth parameter to the synthesizer.\n\t */\n\tpublic setChorusDepth(depthMillisec: number) {\n\t\t_module._fluid_synth_set_chorus_depth(this._synth, depthMillisec);\n\t}\n\t/**\n\t * Set chorus modulation type to the synthesizer.\n\t */\n\tpublic setChorusType(type: ChorusModulation) {\n\t\t_module._fluid_synth_set_chorus_type(this._synth, type);\n\t}\n\t/**\n\t * Enable or disable chorus effect of the synthesizer.\n\t */\n\tpublic setChorusOn(on: boolean) {\n\t\t_module._fluid_synth_set_chorus_on(this._synth, on ? 1 : 0);\n\t}\n\t/**\n\t * Get chorus voice count of the synthesizer.\n\t */\n\tpublic getChorusVoiceCount(): number {\n\t\treturn _module._fluid_synth_get_chorus_nr(this._synth);\n\t}\n\t/**\n\t * Get chorus level of the synthesizer.\n\t */\n\tpublic getChorusLevel(): number {\n\t\treturn _module._fluid_synth_get_chorus_level(this._synth);\n\t}\n\t/**\n\t * Get chorus speed of the synthesizer.\n\t */\n\tpublic getChorusSpeed(): number {\n\t\treturn _module._fluid_synth_get_chorus_speed(this._synth);\n\t}\n\t/**\n\t * Get chorus depth (in milliseconds) of the synthesizer.\n\t */\n\tpublic getChorusDepth(): number {\n\t\treturn _module._fluid_synth_get_chorus_depth(this._synth);\n\t}\n\t/**\n\t * Get chorus modulation type of the synthesizer.\n\t */\n\tpublic getChorusType(): ChorusModulation {\n\t\treturn _module._fluid_synth_get_chorus_type(this._synth);\n\t}\n\n\t/**\n\t * Get generator value assigned to the MIDI channel.\n\t * @param channel MIDI channel number\n\t * @param param generator ID\n\t * @return a value related to the generator\n\t */\n\tpublic getGenerator(channel: number, param: GeneratorTypes): number {\n\t\treturn _module._fluid_synth_get_gen(this._synth, channel, param);\n\t}\n\t/**\n\t * Set generator value assigned to the MIDI channel.\n\t * @param channel MIDI channel number\n\t * @param param generator ID\n\t * @param value a value related to the generator\n\t */\n\tpublic setGenerator(channel: number, param: GeneratorTypes, value: number) {\n\t\t_module._fluid_synth_set_gen(this._synth, channel, param, value);\n\t}\n\t/**\n\t * Return the current legato mode of the channel.\n\t * @param channel MIDI channel number\n\t * @return legato mode\n\t */\n\tpublic getLegatoMode(channel: number) {\n\t\t_module._fluid_synth_get_legato_mode(\n\t\t\tthis._synth,\n\t\t\tchannel,\n\t\t\tthis._numPtr\n\t\t);\n\t\treturn _module.HEAP32[(this._numPtr as number) >> 2] as LegatoMode;\n\t}\n\t/**\n\t * Set the current legato mode of the channel.\n\t * @param channel MIDI channel number\n\t * @param mode legato mode\n\t */\n\tpublic setLegatoMode(channel: number, mode: LegatoMode) {\n\t\t_module._fluid_synth_set_legato_mode(this._synth, channel, mode);\n\t}\n\t/**\n\t * Return the current portamento mode of the channel.\n\t * @param channel MIDI channel number\n\t * @return portamento mode\n\t */\n\tpublic getPortamentoMode(channel: number) {\n\t\t_module._fluid_synth_get_portamento_mode(\n\t\t\tthis._synth,\n\t\t\tchannel,\n\t\t\tthis._numPtr\n\t\t);\n\t\treturn _module.HEAP32[(this._numPtr as number) >> 2] as PortamentoMode;\n\t}\n\t/**\n\t * Set the current portamento mode of the channel.\n\t * @param channel MIDI channel number\n\t * @param mode portamento mode\n\t */\n\tpublic setPortamentoMode(channel: number, mode: PortamentoMode) {\n\t\t_module._fluid_synth_set_portamento_mode(this._synth, channel, mode);\n\t}\n\t/**\n\t * Return the current breath mode of the channel.\n\t * @param channel MIDI channel number\n\t * @return breath mode (BreathFlags)\n\t */\n\tpublic getBreathMode(channel: number) {\n\t\t_module._fluid_synth_get_breath_mode(\n\t\t\tthis._synth,\n\t\t\tchannel,\n\t\t\tthis._numPtr\n\t\t);\n\t\treturn _module.HEAP32[(this._numPtr as number) >> 2] as number;\n\t}\n\t/**\n\t * Set the current breath mode of the channel.\n\t * @param channel MIDI channel number\n\t * @param flags breath mode flags (BreathFlags)\n\t */\n\tpublic setBreathMode(channel: number, flags: number) {\n\t\t_module._fluid_synth_set_breath_mode(this._synth, channel, flags);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////\n\n\tpublic resetPlayer() {\n\t\treturn new Promise<void>((resolve) => {\n\t\t\tthis._initPlayer();\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tpublic closePlayer() {\n\t\tthis._closePlayer();\n\t}\n\n\t/** @internal */\n\tprivate _initPlayer() {\n\t\tthis._closePlayer();\n\n\t\tconst player = _module._new_fluid_player(this._synth);\n\t\tthis._player = player;\n\t\tif (player !== INVALID_POINTER) {\n\t\t\tif (this._fluidSynthCallback === null) {\n\t\t\t\t// hacky retrieve 'fluid_synth_handle_midi_event' callback pointer\n\t\t\t\t// * 'playback_callback' is filled with 'fluid_synth_handle_midi_event' by default.\n\t\t\t\t// * 'playback_userdata' is filled with the synthesizer pointer by default\n\t\t\t\tconst funcPtr: PointerType =\n\t\t\t\t\t_module.HEAPU32[((player as number) + 588) >> 2]; // _fluid_player_t::playback_callback\n\t\t\t\tconst synthPtr: SynthId =\n\t\t\t\t\t_module.HEAPU32[((player as number) + 592) >> 2]; // _fluid_player_t::playback_userdata\n\t\t\t\tif (synthPtr === this._synth) {\n\t\t\t\t\tthis._fluidSynthCallback = funcPtr;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error(\"Out of memory\");\n\t\t}\n\t}\n\n\t/** @internal */\n\tprivate _closePlayer() {\n\t\tconst p = this._player;\n\t\tif (p === INVALID_POINTER) {\n\t\t\treturn;\n\t\t}\n\t\tthis.stopPlayer();\n\t\t_module._delete_fluid_player(p);\n\t\tthis._player = INVALID_POINTER;\n\t\tthis._playerCallbackPtr = null;\n\t}\n\n\tpublic isPlayerPlaying() {\n\t\tif (this._playerPlaying) {\n\t\t\tconst status = _module._fluid_player_get_status(this._player);\n\t\t\tif (status === 1 /*FLUID_PLAYER_PLAYING*/) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.stopPlayer();\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic addSMFDataToPlayer(bin: ArrayBuffer) {\n\t\tthis.ensurePlayerInitialized();\n\t\tconst len = bin.byteLength;\n\t\tconst mem = malloc(len);\n\t\t_module.HEAPU8.set(new Uint8Array(bin), mem);\n\t\tconst r: number = _module._fluid_player_add_mem(this._player, mem, len);\n\t\tfree(mem);\n\t\treturn r !== -1\n\t\t\t? Promise.resolve()\n\t\t\t: Promise.reject(new Error(fluid_synth_error!(this._synth)));\n\t}\n\n\tpublic playPlayer() {\n\t\tthis.ensurePlayerInitialized();\n\t\tif (this._playerPlaying) {\n\t\t\tthis.stopPlayer();\n\t\t}\n\n\t\tif (_module._fluid_player_play(this._player) === -1) {\n\t\t\treturn Promise.reject(new Error(fluid_synth_error!(this._synth)));\n\t\t}\n\t\tthis._playerPlaying = true;\n\t\tlet resolver = () => {};\n\t\tconst p = new Promise<void>((resolve) => {\n\t\t\tresolver = resolve;\n\t\t});\n\t\tthis._playerDefer = {\n\t\t\tpromise: p,\n\t\t\tresolve: resolver,\n\t\t};\n\t\treturn Promise.resolve();\n\t}\n\n\tpublic stopPlayer() {\n\t\tconst p = this._player;\n\t\tif (p === INVALID_POINTER || !this._playerPlaying) {\n\t\t\treturn;\n\t\t}\n\t\t_module._fluid_player_stop(p);\n\t\t_module._fluid_player_join(p);\n\t\t_module._fluid_synth_all_sounds_off(this._synth, -1);\n\t\tif (this._playerDefer) {\n\t\t\tthis._playerDefer.resolve();\n\t\t\tthis._playerDefer = void 0;\n\t\t}\n\t\tthis._playerPlaying = false;\n\t}\n\n\tpublic retrievePlayerCurrentTick(): Promise<number> {\n\t\tthis.ensurePlayerInitialized();\n\t\treturn Promise.resolve(\n\t\t\t_module._fluid_player_get_current_tick(this._player)\n\t\t);\n\t}\n\tpublic retrievePlayerTotalTicks(): Promise<number> {\n\t\tthis.ensurePlayerInitialized();\n\t\treturn Promise.resolve(\n\t\t\t_module._fluid_player_get_total_ticks(this._player)\n\t\t);\n\t}\n\tpublic retrievePlayerBpm(): Promise<number> {\n\t\tthis.ensurePlayerInitialized();\n\t\treturn Promise.resolve(_module._fluid_player_get_bpm(this._player));\n\t}\n\tpublic retrievePlayerMIDITempo(): Promise<number> {\n\t\tthis.ensurePlayerInitialized();\n\t\treturn Promise.resolve(\n\t\t\t_module._fluid_player_get_midi_tempo(this._player)\n\t\t);\n\t}\n\tpublic seekPlayer(ticks: number): void {\n\t\tthis.ensurePlayerInitialized();\n\t\t_module._fluid_player_seek(this._player, ticks);\n\t}\n\tpublic setPlayerLoop(loopTimes: number): void {\n\t\tthis.ensurePlayerInitialized();\n\t\t_module._fluid_player_set_loop(this._player, loopTimes);\n\t}\n\tpublic setPlayerTempo(tempoType: PlayerSetTempoType, tempo: number): void {\n\t\tthis.ensurePlayerInitialized();\n\t\t_module._fluid_player_set_tempo(this._player, tempoType, tempo);\n\t}\n\n\t/**\n\t * Hooks MIDI events sent by the player.\n\t * initPlayer() must be called before calling this method.\n\t * @param callback hook callback function, or null to unhook\n\t * @param param any additional data passed to the callback\n\t */\n\tpublic hookPlayerMIDIEvents(\n\t\tcallback: HookMIDIEventCallback | null,\n\t\tparam?: any\n\t) {\n\t\tthis.ensurePlayerInitialized();\n\n\t\tconst oldPtr = this._playerCallbackPtr;\n\t\tif (oldPtr === null && callback === null) {\n\t\t\treturn;\n\t\t}\n\t\tconst newPtr =\n\t\t\t// if callback is specified, add function\n\t\t\tcallback !== null\n\t\t\t\t? _addFunction(\n\t\t\t\t\t\tmakeMIDIEventCallback(this, callback, param),\n\t\t\t\t\t\t\"iii\"\n\t\t\t\t  )\n\t\t\t\t: // if _fluidSynthCallback is filled, set null to use it for reset callback\n\t\t\t\t// if not, add function defaultMIDIEventCallback for reset\n\t\t\t\tthis._fluidSynthCallback !== null\n\t\t\t\t? null\n\t\t\t\t: _addFunction(defaultMIDIEventCallback, \"iii\");\n\t\t// the third parameter of 'fluid_player_set_playback_callback' should be 'fluid_synth_t*'\n\t\tif (oldPtr !== null && newPtr !== null) {\n\t\t\t// (using defaultMIDIEventCallback also comes here)\n\t\t\t_module._fluid_player_set_playback_callback(\n\t\t\t\tthis._player,\n\t\t\t\tnewPtr,\n\t\t\t\tthis._synth\n\t\t\t);\n\t\t\t_removeFunction(oldPtr);\n\t\t} else {\n\t\t\tif (newPtr === null) {\n\t\t\t\t// newPtr === null --> use _fluidSynthCallback\n\t\t\t\t_module._fluid_player_set_playback_callback(\n\t\t\t\t\tthis._player,\n\t\t\t\t\tthis._fluidSynthCallback!,\n\t\t\t\t\tthis._synth\n\t\t\t\t);\n\t\t\t\t_removeFunction(oldPtr!);\n\t\t\t} else {\n\t\t\t\t_module._fluid_player_set_playback_callback(\n\t\t\t\t\tthis._player,\n\t\t\t\t\tnewPtr,\n\t\t\t\t\tthis._synth\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tthis._playerCallbackPtr = newPtr;\n\t}\n\n\t/** @internal */\n\tprivate ensureInitialized() {\n\t\tif (this._synth === INVALID_POINTER) {\n\t\t\tthrow new Error(\"Synthesizer is not initialized\");\n\t\t}\n\t}\n\n\t/** @internal */\n\tprivate ensurePlayerInitialized() {\n\t\tthis.ensureInitialized();\n\t\tif (this._player === INVALID_POINTER) {\n\t\t\tthis._initPlayer();\n\t\t}\n\t}\n\n\t/** @internal */\n\tprivate renderRaw(\n\t\tmemLeft: PointerType,\n\t\tmemRight: PointerType,\n\t\tframeCount: number\n\t) {\n\t\t_module._fluid_synth_write_float(\n\t\t\tthis._synth,\n\t\t\tframeCount,\n\t\t\tmemLeft,\n\t\t\t0,\n\t\t\t1,\n\t\t\tmemRight,\n\t\t\t0,\n\t\t\t1\n\t\t);\n\t}\n\n\t/** @internal */\n\tprivate flushFramesSync() {\n\t\tconst frameCount = 65536;\n\t\tconst size = 4 * frameCount;\n\t\tconst mem = malloc(size * 2);\n\t\tconst memLeft = mem;\n\t\tconst memRight = ((mem as number) + size) as PointerType;\n\t\twhile (this.isPlaying()) {\n\t\t\tthis.renderRaw(memLeft, memRight, frameCount);\n\t\t}\n\t\tfree(mem);\n\t}\n\n\t/** @internal */\n\tprivate flushFramesAsync() {\n\t\tif (!this.isPlaying()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst frameCount = 65536;\n\t\tconst size = 4 * frameCount;\n\t\tconst mem = malloc(size * 2);\n\t\tconst memLeft = mem;\n\t\tconst memRight = ((mem as number) + size) as PointerType;\n\t\tconst nextFrame =\n\t\t\ttypeof setTimeout !== \"undefined\"\n\t\t\t\t? () => {\n\t\t\t\t\t\treturn new Promise<void>((resolve) =>\n\t\t\t\t\t\t\tsetTimeout(resolve, 0)\n\t\t\t\t\t\t);\n\t\t\t\t  }\n\t\t\t\t: () => {\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t  };\n\t\tfunction head(): Promise<void> {\n\t\t\treturn nextFrame().then(tail);\n\t\t}\n\t\tconst self = this;\n\t\tfunction tail(): Promise<void> {\n\t\t\tif (!self.isPlaying()) {\n\t\t\t\tfree(mem);\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\tself.renderRaw(memLeft, memRight, frameCount);\n\t\t\treturn head();\n\t\t}\n\t\treturn head();\n\t}\n\n\tpublic waitForPlayerStopped() {\n\t\treturn this._playerDefer\n\t\t\t? this._playerDefer.promise\n\t\t\t: Promise.resolve();\n\t}\n\n\t/**\n\t * Create the sequencer object for this class.\n\t */\n\tpublic static createSequencer(): Promise<ISequencer> {\n\t\tbindFunctions();\n\t\tconst seq = new Sequencer();\n\t\treturn seq._initialize().then(() => seq);\n\t}\n\n\t/**\n\t * Registers the user-defined client to the sequencer.\n\t * The client can receive events in the time from sequencer process.\n\t * @param seq the sequencer instance created by Synthesizer.createSequencer\n\t * @param name the client name\n\t * @param callback the client callback function that processes event data\n\t * @param param additional parameter passed to the callback\n\t * @return registered sequencer client id (can be passed to seq.unregisterClient())\n\t */\n\tpublic static registerSequencerClient(\n\t\tseq: ISequencer,\n\t\tname: string,\n\t\tcallback: SequencerClientCallback,\n\t\tparam: number\n\t): number {\n\t\tif (!(seq instanceof Sequencer)) {\n\t\t\tthrow new TypeError(\"Invalid sequencer instance\");\n\t\t}\n\t\tconst ptr = _addFunction(\n\t\t\t(time: number, ev: PointerType, _seq: number, data: number) => {\n\t\t\t\tconst e = new SequencerEventData(ev, _module);\n\t\t\t\tconst type: SequencerEventType =\n\t\t\t\t\t_module._fluid_event_get_type(ev);\n\t\t\t\tcallback(time, type, e, seq, data);\n\t\t\t},\n\t\t\t\"viiii\"\n\t\t);\n\t\tconst r = fluid_sequencer_register_client(\n\t\t\tseq.getRaw(),\n\t\t\tname,\n\t\t\tptr,\n\t\t\tparam\n\t\t);\n\t\tif (r !== -1) {\n\t\t\tseq._clientFuncMap[r] = ptr;\n\t\t}\n\t\treturn r;\n\t}\n\n\t/**\n\t * Send sequencer event immediately to the specific client.\n\t * @param seq the sequencer instance created by Synthesizer.createSequencer\n\t * @param clientId registered client id (-1 for registered synthesizer)\n\t * @param event event data\n\t */\n\tpublic static sendEventToClientNow(\n\t\tseq: ISequencer,\n\t\tclientId: number,\n\t\tevent: SequencerEvent\n\t): void {\n\t\tif (!(seq instanceof Sequencer)) {\n\t\t\tthrow new TypeError(\"Invalid sequencer instance\");\n\t\t}\n\t\tseq.sendEventToClientNow(clientId, event);\n\t}\n\t/**\n\t * (Re-)send event data immediately.\n\t * @param seq the sequencer instance created by Synthesizer.createSequencer\n\t * @param clientId registered client id (-1 for registered synthesizer)\n\t * @param eventData event data which can be retrieved in SequencerClientCallback\n\t */\n\tpublic static sendEventNow(\n\t\tseq: ISequencer,\n\t\tclientId: number,\n\t\teventData: ISequencerEventData\n\t): void {\n\t\tif (!(seq instanceof Sequencer)) {\n\t\t\tthrow new TypeError(\"Invalid sequencer instance\");\n\t\t}\n\t\tseq.sendEventNow(clientId, eventData);\n\t}\n\t/**\n\t * Set interval timer process to call processSequencer for this sequencer.\n\t * This method uses 'setInterval' global method to register timer.\n\t * @param seq the sequencer instance created by Synthesizer.createSequencer\n\t * @param msec time in milliseconds passed to both setInterval and processSequencer\n\t * @return return value of 'setInterval' (usually passing to 'clearInterval' will reset event)\n\t */\n\tpublic static setIntervalForSequencer(seq: ISequencer, msec: number) {\n\t\tif (!(seq instanceof Sequencer)) {\n\t\t\tthrow new TypeError(\"Invalid sequencer instance\");\n\t\t}\n\t\treturn seq.setIntervalForSequencer(msec);\n\t}\n}\n","import Synthesizer from './Synthesizer';\n\n/**\n * Returns the Promise object which resolves when the synthesizer engine is ready.\n */\nexport default function waitForReady(): Promise<void> {\n\treturn Synthesizer.waitForWasmInitialized();\n}\n","\nimport MessageError from './MessageError';\n\nexport interface MethodCallEventData {\n\tid: number;\n\tmethod: string;\n\targs: any[];\n}\n\nexport interface MethodReturnEventData {\n\tid: number;\n\tmethod: string;\n\tval: any;\n\terror?: MessageErrorData;\n}\n\nexport interface MessageErrorData {\n\tbaseName: string;\n\tmessage: string;\n\tdetail: any;\n}\n\n/** @internal */\nexport interface Defer<T> {\n\tresolve(value: T): void;\n\treject(reason: any): void;\n}\n\n/** @internal */\nexport interface DeferMap {\n\t[id: number]: Defer<any>;\n}\n\n/** @internal */\nexport type HookReturnMessageCallback = (data: MethodReturnEventData) => boolean;\n\n/** @internal */\nexport interface CallMessageInstance {\n\tport: MessagePort;\n\tdefers: DeferMap;\n\tdeferId: number;\n}\n\n/** @internal */\nexport function initializeCallPort(\n\tport: MessagePort,\n\thookMessage?: HookReturnMessageCallback | undefined\n): CallMessageInstance {\n\tconst instance: CallMessageInstance = {\n\t\tport: port,\n\t\tdefers: {},\n\t\tdeferId: 0\n\t};\n\tport.addEventListener('message', (e) => processReturnMessage(instance.defers, hookMessage, e));\n\tport.start();\n\treturn instance;\n}\n\nfunction convertErrorTransferable(err: Error): MessageErrorData {\n\tconst result: any = {};\n\tconst objList: any[] = [];\n\tlet obj: any = err;\n\twhile (obj && obj !== Object.prototype) {\n\t\tobjList.unshift(obj);\n\t\tobj = Object.getPrototypeOf(obj);\n\t}\n\tobjList.forEach((o) => {\n\t\tObject.getOwnPropertyNames(o).forEach((key) => {\n\t\t\ttry {\n\t\t\t\tconst data = (err as any)[key];\n\t\t\t\tif (typeof data !== 'function' && typeof data !== 'symbol') {\n\t\t\t\t\tresult[key] = data;\n\t\t\t\t}\n\t\t\t} catch (_e) { }\n\t\t});\n\t});\n\treturn {\n\t\tbaseName: err.name,\n\t\tmessage: err.message,\n\t\tdetail: result\n\t};\n}\n\nfunction convertAnyErrorTransferable(err: any): MessageErrorData {\n\treturn convertErrorTransferable((err && err instanceof Error) ? err : new Error(`${err}`));\n}\n\nfunction makeMessageError(error: MessageErrorData): MessageError {\n\treturn new MessageError(error.baseName, error.message, error.detail);\n}\n\nfunction processReturnMessage(defers: DeferMap, hook: HookReturnMessageCallback | undefined, e: MessageEvent) {\n\tconst data: MethodReturnEventData = e.data;\n\tif (!data) {\n\t\treturn;\n\t}\n\tif (hook && hook(data)) {\n\t\treturn;\n\t}\n\tconst defer = defers[data.id];\n\tif (defer) {\n\t\tdelete defers[data.id];\n\t\tif (data.error) {\n\t\t\tdefer.reject(makeMessageError(data.error));\n\t\t} else {\n\t\t\tdefer.resolve(data.val);\n\t\t}\n\t} else {\n\t\tif (data.error) {\n\t\t\tthrow makeMessageError(data.error);\n\t\t}\n\t}\n}\n\n/** @internal */\nexport function postCall(instance: CallMessageInstance, method: string, args: any[]): void;\n\n/** @internal */\nexport function postCall({ port }: CallMessageInstance, method: string, args: any[]) {\n\tport.postMessage({\n\t\tid: -1, method, args\n\t} as MethodCallEventData);\n}\n\n/** @internal */\nexport function postCallWithPromise<T>(instance: CallMessageInstance, method: string, args: any[]): Promise<T> {\n\tconst id = instance.deferId++;\n\tif (instance.deferId === Infinity || instance.deferId < 0) {\n\t\tinstance.deferId = 0;\n\t}\n\tconst promise = new Promise<T>((resolve, reject) => {\n\t\tinstance.defers[id] = { resolve, reject };\n\t});\n\tconst transfers: Transferable[] = [];\n\tif (args[0] instanceof MessagePort) {\n\t\ttransfers.push(args[0]);\n\t}\n\tinstance.port.postMessage({\n\t\tid, method, args\n\t} as MethodCallEventData, transfers);\n\treturn promise;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/** @internal */\nexport type HookCallMessageCallback = (data: MethodCallEventData) => boolean;\n\n/** @internal */\nexport interface ReturnMessageInstance {\n\tport: MessagePort;\n}\n\n/** @internal */\nexport function initializeReturnPort(\n\tport: MessagePort,\n\tpromiseInitialized: Promise<void> | null,\n\ttargetObjectHolder: () => any,\n\thookMessage?: HookCallMessageCallback | undefined\n): ReturnMessageInstance {\n\tconst instance: ReturnMessageInstance = {\n\t\tport: port\n\t};\n\tif (promiseInitialized) {\n\t\tport.addEventListener('message', (e) => {\n\t\t\tconst data = e.data;\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpromiseInitialized.then(() => processCallMessage(instance.port, data, targetObjectHolder, hookMessage));\n\t\t});\n\t} else {\n\t\tport.addEventListener('message', (e) => {\n\t\t\tconst data = e.data;\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprocessCallMessage(instance.port, data, targetObjectHolder, hookMessage);\n\t\t});\n\t}\n\tport.start();\n\treturn instance;\n}\n\nfunction processCallMessage(\n\tport: MessagePort,\n\tdata: MethodCallEventData,\n\ttargetObjectHolder: () => any,\n\thook?: HookCallMessageCallback | undefined\n) {\n\tif (hook && hook(data)) {\n\t\treturn;\n\t}\n\tconst target = targetObjectHolder();\n\tif (!target[data.method]) {\n\t\tpostReturnErrorImpl(port, data.id, data.method, new Error('Not implemented'));\n\t} else {\n\t\ttry {\n\t\t\tpostReturnImpl(port, data.id, data.method, target[data.method].apply(target, data.args));\n\t\t} catch (e) {\n\t\t\tpostReturnErrorImpl(port, data.id, data.method, e);\n\t\t}\n\t}\n}\n\n/** @internal */\nexport function postReturn(instance: ReturnMessageInstance, id: number, method: string, value: any) {\n\tpostReturnImpl(instance.port, id, method, value);\n}\n\nfunction postReturnImpl(port: MessagePort, id: number, method: string, value: any) {\n\tif (value instanceof Promise) {\n\t\tvalue.then((v) => {\n\t\t\tif (id >= 0) {\n\t\t\t\tport.postMessage({\n\t\t\t\t\tid,\n\t\t\t\t\tmethod,\n\t\t\t\t\tval: v\n\t\t\t\t} as MethodReturnEventData);\n\t\t\t}\n\t\t}, (error) => {\n\t\t\tport.postMessage({\n\t\t\t\tid,\n\t\t\t\tmethod,\n\t\t\t\terror: convertAnyErrorTransferable(error)\n\t\t\t} as MethodReturnEventData);\n\t\t});\n\t} else {\n\t\tport.postMessage({\n\t\t\tid,\n\t\t\tmethod,\n\t\t\tval: value\n\t\t} as MethodReturnEventData);\n\t}\n}\n\n/** @internal */\nexport function postReturnError(instance: ReturnMessageInstance, id: number, method: string, error: any) {\n\tpostReturnErrorImpl(instance.port, id, method, error);\n}\n\nfunction postReturnErrorImpl(port: MessagePort, id: number, method: string, error: any) {\n\tport.postMessage({\n\t\tid,\n\t\tmethod,\n\t\terror: convertAnyErrorTransferable(error)\n\t} as MethodReturnEventData);\n}\n","import Preset from './Preset';\n\nimport * as MethodMessaging from './MethodMessaging';\n\nexport default class WorkletSoundfont {\n\t// @internal\n\tprivate _messaging: MethodMessaging.CallMessageInstance;\n\n\t// @internal\n\tpublic constructor(port: MessagePort, private readonly name: string) {\n\t\tthis._messaging = MethodMessaging.initializeCallPort(port);\n\t}\n\n\tpublic getName(): string {\n\t\treturn this.name;\n\t}\n\n\tpublic getPreset(bank: number, presetNum: number): Promise<Preset | null> {\n\t\treturn MethodMessaging.postCallWithPromise(this._messaging, 'getPreset', [bank, presetNum]);\n\t}\n\n\tpublic getPresetIterable(): Promise<Iterable<Preset>> {\n\t\treturn MethodMessaging.postCallWithPromise<Preset[]>(this._messaging, 'getPresetIterable', []);\n\t}\n}\n","\nimport ISequencer, { ClientInfo } from './ISequencer';\nimport ISynthesizer from './ISynthesizer';\nimport SequencerEvent from './SequencerEvent';\n\nimport AudioWorkletNodeSynthesizer from './AudioWorkletNodeSynthesizer';\n\nimport * as MethodMessaging from './MethodMessaging';\n\n/** @internal */\nexport default class WorkletSequencer implements ISequencer {\n\t/** @internal */\n\tprivate _messaging: MethodMessaging.CallMessageInstance | null;\n\n\tconstructor(port: MessagePort) {\n\t\tthis._messaging = MethodMessaging.initializeCallPort(port);\n\t}\n\n\t/** @internal */\n\tpublic getRaw(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getRaw', []);\n\t}\n\t/** @internal */\n\tpublic registerSequencerClientByName(clientName: string, callbackName: string, param: number): Promise<number> {\n\t\treturn this.getRaw().then((seqPtr) => MethodMessaging.postCallWithPromise<number>(\n\t\t\tthis._messaging!,\n\t\t\t'registerSequencerClientByName',\n\t\t\t[seqPtr, clientName, callbackName, param]\n\t\t));\n\t}\n\n\tpublic close(): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'close', []);\n\t}\n\tpublic registerSynthesizer(synth: ISynthesizer | number): Promise<number> {\n\t\tlet val: Promise<number>;\n\t\tif (synth instanceof AudioWorkletNodeSynthesizer) {\n\t\t\tval = synth._getRawSynthesizer();\n\t\t} else {\n\t\t\treturn Promise.reject(new TypeError('\\'synth\\' is not a compatible type instance'));\n\t\t}\n\t\treturn val.then((v) => MethodMessaging.postCallWithPromise<number>(this._messaging!, 'registerSynthesizer', [v]));\n\t}\n\tpublic unregisterClient(clientId: number): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'unregisterClient', [clientId]);\n\t}\n\tpublic getAllRegisteredClients(): Promise<ClientInfo[]> {\n\t\treturn MethodMessaging.postCallWithPromise<ClientInfo[]>(this._messaging!, 'getAllRegisteredClients', []);\n\t}\n\tpublic getClientCount(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getClientCount', []);\n\t}\n\tpublic getClientInfo(index: number): Promise<ClientInfo> {\n\t\treturn MethodMessaging.postCallWithPromise<ClientInfo>(this._messaging!, 'getClientInfo', [index]);\n\t}\n\tpublic setTimeScale(scale: number): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'setTimeScale', [scale]);\n\t}\n\tpublic getTimeScale(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getTimeScale', []);\n\t}\n\tpublic getTick(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getTick', []);\n\t}\n\tpublic sendEventAt(event: SequencerEvent, tick: number, isAbsolute: boolean): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'sendEventAt', [event, tick, isAbsolute]);\n\t}\n\tpublic sendEventToClientAt(clientId: number, event: SequencerEvent, tick: number, isAbsolute: boolean): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'sendEventToClientAt', [clientId, event, tick, isAbsolute]);\n\t}\n\tpublic removeAllEvents(): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'removeAllEvents', []);\n\t}\n\tpublic removeAllEventsFromClient(clientId: number): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'removeAllEventsFromClient', [clientId]);\n\t}\n\n\tpublic processSequencer(msecToProcess: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'processSequencer', [msecToProcess]);\n\t}\n}\n","\nimport { SynthesizerDefaultValues, InterpolationValues, PlayerSetTempoType } from './Constants';\nimport ISequencer from './ISequencer';\nimport ISynthesizer from './ISynthesizer';\nimport SynthesizerSettings from './SynthesizerSettings';\nimport WorkletSoundfont from './WorkletSoundfont';\nimport WorkletSequencer from './WorkletSequencer';\nimport * as MethodMessaging from './MethodMessaging';\nimport { addLoggingStatusChangedHandler, getDisabledLoggingLevel, LogLevel } from './logging';\n\n/** @internal */\nexport const enum Constants {\n\tProcessorName = 'js-synthesizer',\n\tUpdateStatus = 'updateStatus',\n}\n/** @internal */\nexport interface SynthesizerStatus {\n\tplaying: boolean;\n\tplayerPlaying: boolean;\n}\n/** @internal */\nexport interface ProcessorOptions {\n\tsettings?: SynthesizerSettings;\n\tdisabledLoggingLevel?: LogLevel | null;\n}\n\n/** An synthesizer object with AudioWorkletNode */\nexport default class AudioWorkletNodeSynthesizer implements ISynthesizer {\n\n\t/** @internal */\n\tprivate _status: SynthesizerStatus;\n\t/** @internal */\n\tprivate _messaging: MethodMessaging.CallMessageInstance | null;\n\t/** @internal */\n\tprivate _node: AudioWorkletNode | null;\n\t/** @internal */\n\tprivate _gain: number;\n\n\t/** @internal */\n\tprivate handleLoggingChanged: (level: LogLevel | null) => void;\n\n\tconstructor() {\n\t\tthis._status = {\n\t\t\tplaying: false,\n\t\t\tplayerPlaying: false\n\t\t};\n\t\tthis._messaging = null;\n\t\tthis._node = null;\n\t\tthis._gain = SynthesizerDefaultValues.Gain;\n\t\tthis.handleLoggingChanged = this._handleLoggingChanged.bind(this);\n\t\taddLoggingStatusChangedHandler(this.handleLoggingChanged);\n\t}\n\n\t/** Audio node for this synthesizer */\n\tpublic get node(): AudioWorkletNode | null {\n\t\treturn this._node;\n\t}\n\n\t/**\n\t * Create AudiWorkletNode instance\n\t */\n\tpublic createAudioNode(context: AudioContext, settings?: SynthesizerSettings) {\n\t\tconst processorOptions: ProcessorOptions = {\n\t\t\tsettings: settings,\n\t\t\tdisabledLoggingLevel: getDisabledLoggingLevel(),\n\t\t};\n\t\tconst node = new AudioWorkletNode(context, Constants.ProcessorName, {\n\t\t\tnumberOfInputs: 0,\n\t\t\tnumberOfOutputs: 1,\n\t\t\tchannelCount: 2,\n\t\t\toutputChannelCount: [2],\n\t\t\tprocessorOptions: processorOptions,\n\t\t});\n\t\tthis._node = node;\n\n\t\tthis._messaging = MethodMessaging.initializeCallPort(node.port, (data) => {\n\t\t\tif (data.method === Constants.UpdateStatus) {\n\t\t\t\tthis._status = data.val;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\treturn node;\n\t}\n\n\tpublic isInitialized() {\n\t\treturn this._messaging !== null;\n\t}\n\n\tpublic init(_sampleRate: number, _settings?: SynthesizerSettings) {\n\t}\n\n\tpublic close() {\n\t\t// call init instead of close\n\t\tMethodMessaging.postCall(this._messaging!, 'init', [0]);\n\t}\n\n\tpublic isPlaying() {\n\t\treturn this._status.playing;\n\t}\n\n\tpublic setInterpolation(value: InterpolationValues, channel?: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'setInterpolation', [value, channel]);\n\t}\n\n\tpublic getGain() {\n\t\treturn this._gain;\n\t}\n\n\tpublic setGain(gain: number) {\n\t\tthis._gain = gain;\n\t\tMethodMessaging.postCallWithPromise<void>(this._messaging!, 'setGain', [gain]).then(() => {\n\t\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getGain', []);\n\t\t}).then((value) => {\n\t\t\tthis._gain = value;\n\t\t});\n\t}\n\n\tpublic setChannelType(channel: number, isDrum: boolean) {\n\t\tMethodMessaging.postCall(this._messaging!, 'setChannelType', [channel, isDrum]);\n\t}\n\n\tpublic waitForVoicesStopped() {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'waitForVoicesStopped', []);\n\t}\n\n\tpublic loadSFont(bin: ArrayBuffer) {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'loadSFont', [bin]);\n\t}\n\n\tpublic unloadSFont(id: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'unloadSFont', [id]);\n\t}\n\n\tpublic unloadSFontAsync(id: number) {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'unloadSFont', [id]);\n\t}\n\n\t/**\n\t * Returns the `Soundfont` instance for specified SoundFont.\n\t * @param sfontId loaded SoundFont id ({@link loadSFont} returns this)\n\t * @return resolve with `Soundfont` instance (rejected if `sfontId` is not valid or loaded)\n\t */\n\tpublic getSFontObject(sfontId: number): Promise<WorkletSoundfont> {\n\t\tconst channel = new MessageChannel();\n\t\treturn MethodMessaging.postCallWithPromise<string>(this._messaging!, 'getSFontObject', [channel.port2, sfontId]).then((name) => {\n\t\t\treturn new WorkletSoundfont(channel.port1, name);\n\t\t});\n\t}\n\n\tpublic getSFontBankOffset(id: number) {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getSFontBankOffset', [id]);\n\t}\n\tpublic setSFontBankOffset(id: number, offset: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'setSFontBankOffset', [id, offset]);\n\t}\n\n\tpublic render() {\n\t\tthrow new Error('Unexpected call');\n\t}\n\n\tpublic midiNoteOn(chan: number, key: number, vel: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiNoteOn', [chan, key, vel]);\n\t}\n\tpublic midiNoteOff(chan: number, key: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiNoteOff', [chan, key]);\n\t}\n\tpublic midiKeyPressure(chan: number, key: number, val: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiKeyPressure', [chan, key, val]);\n\t}\n\tpublic midiControl(chan: number, ctrl: number, val: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiControl', [chan, ctrl, val]);\n\t}\n\tpublic midiProgramChange(chan: number, prognum: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiProgramChange', [chan, prognum]);\n\t}\n\tpublic midiChannelPressure(chan: number, val: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiChannelPressure', [chan, val]);\n\t}\n\tpublic midiPitchBend(chan: number, val: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiPitchBend', [chan, val]);\n\t}\n\tpublic midiSysEx(data: Uint8Array) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiSysEx', [data]);\n\t}\n\n\tpublic midiPitchWheelSensitivity(chan: number, val: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiPitchWheelSensitivity', [chan, val]);\n\t}\n\tpublic midiBankSelect(chan: number, bank: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiBankSelect', [chan, bank]);\n\t}\n\tpublic midiSFontSelect(chan: number, sfontId: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiSFontSelect', [chan, sfontId]);\n\t}\n\tpublic midiProgramSelect(chan: number, sfontId: number, bank: number, presetNum: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiProgramSelect', [chan, sfontId, bank, presetNum]);\n\t}\n\tpublic midiUnsetProgram(chan: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiUnsetProgram', [chan]);\n\t}\n\tpublic midiProgramReset() {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiProgramReset', []);\n\t}\n\tpublic midiSystemReset() {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiSystemReset', []);\n\t}\n\tpublic midiAllNotesOff(chan?: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiAllNotesOff', [chan]);\n\t}\n\tpublic midiAllSoundsOff(chan?: number) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiAllSoundsOff', [chan]);\n\t}\n\tpublic midiSetChannelType(chan: number, isDrum: boolean) {\n\t\tMethodMessaging.postCall(this._messaging!, 'midiSetChannelType', [chan, isDrum]);\n\t}\n\n\tpublic resetPlayer() {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'resetPlayer', []);\n\t}\n\n\tpublic closePlayer() {\n\t\tMethodMessaging.postCall(this._messaging!, 'closePlayer', []);\n\t}\n\n\tpublic isPlayerPlaying() {\n\t\treturn this._status.playerPlaying;\n\t}\n\n\tpublic addSMFDataToPlayer(bin: ArrayBuffer) {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'addSMFDataToPlayer', [bin]);\n\t}\n\n\tpublic playPlayer() {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'playPlayer', []);\n\t}\n\n\tpublic stopPlayer() {\n\t\tMethodMessaging.postCall(this._messaging!, 'stopPlayer', []);\n\t}\n\n\tpublic retrievePlayerCurrentTick(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'retrievePlayerCurrentTick', []);\n\t}\n\tpublic retrievePlayerTotalTicks(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'retrievePlayerTotalTicks', []);\n\t}\n\tpublic retrievePlayerBpm(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'retrievePlayerBpm', []);\n\t}\n\tpublic retrievePlayerMIDITempo(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'retrievePlayerMIDITempo', []);\n\t}\n\tpublic seekPlayer(ticks: number): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'seekPlayer', [ticks]);\n\t}\n\tpublic setPlayerLoop(loopTimes: number): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'setPlayerLoop', [loopTimes]);\n\t}\n\tpublic setPlayerTempo(tempoType: PlayerSetTempoType, tempo: number): void {\n\t\tMethodMessaging.postCall(this._messaging!, 'setPlayerTempo', [tempoType, tempo]);\n\t}\n\n\tpublic waitForPlayerStopped() {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'waitForPlayerStopped', []);\n\t}\n\n\t/**\n\t * Creates a sequencer instance associated with this worklet node.\n\t */\n\tpublic createSequencer(): Promise<ISequencer> {\n\t\tconst channel = new MessageChannel();\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'createSequencer', [channel.port2]).then(() => {\n\t\t\treturn new WorkletSequencer(channel.port1);\n\t\t});\n\t}\n\n\t/**\n\t * Hooks MIDI events sent by the player. The hook callback function defined on\n\t * AudioWorkletGlobalScope object available in the worklet is used.\n\t * @param callbackName hook callback function name available as 'AudioWorkletGlobalScope[callbackName]',\n\t *     or falsy value ('', null, or undefined) to unhook.\n\t *     The type of 'AudioWorkletGlobalScope[callbackName]' must be HookMIDIEventCallback.\n\t * @param param any additional data passed to the callback.\n\t *     This data must be 'Transferable' data.\n\t * @return Promise object that resolves when succeeded, or rejects when failed\n\t */\n\tpublic hookPlayerMIDIEventsByName(callbackName: string | null | undefined, param?: any): Promise<void> {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'hookPlayerMIDIEventsByName', [callbackName, param]);\n\t}\n\n\t/**\n\t * Registers the user-defined client to the sequencer.\n\t * The client callback function defined on AudioWorkletGlobalScope\n\t * object available in the worklet is used.\n\t * The client can receive events in the time from sequencer process.\n\t * @param seq the sequencer instance created by AudioWorkletNodeSynthesizer.createSequencer\n\t * @param clientName the client name\n\t * @param callbackName callback function name available as 'AudioWorkletGlobalScope[callbackName]',\n\t *     or falsy value ('', null, or undefined) to unhook.\n\t *     The type of 'AudioWorkletGlobalScope[callbackName]' must be SequencerClientCallback.\n\t * @param param additional parameter passed to the callback\n\t * @return Promise object that resolves with registered client id when succeeded, or rejects when failed\n\t */\n\tpublic registerSequencerClientByName(seq: ISequencer, clientName: string, callbackName: string, param: number): Promise<number> {\n\t\tif (!(seq instanceof WorkletSequencer)) {\n\t\t\treturn Promise.reject(new TypeError('Invalid sequencer object'));\n\t\t}\n\t\treturn seq.registerSequencerClientByName(clientName, callbackName, param);\n\t}\n\n\t/**\n\t * Call a function defined in the AudioWorklet.\n\t *\n\t * The function will receive two parameters; the first parameter is a Synthesizer instance\n\t * (not AudioWorkletNodeSynthesizer instance), and the second is the data passed to 'param'.\n\t * This method is useful when the script loaded in AudioWorklet wants to\n\t * retrieve Synthesizer instance.\n\t *\n\t * @param name a function name (must be retrieved from AudioWorkletGlobalScope[name])\n\t * @param param any parameter (must be Transferable)\n\t * @return Promise object that resolves when the function process has done, or rejects when failed\n\t */\n\tpublic callFunction(name: string, param: any) {\n\t\treturn MethodMessaging.postCallWithPromise<void>(this._messaging!, 'callFunction', [name, param]);\n\t}\n\n\t/** @internal */\n\tpublic _getRawSynthesizer(): Promise<number> {\n\t\treturn MethodMessaging.postCallWithPromise<number>(this._messaging!, 'getRawSynthesizer', []);\n\t}\n\n\t/** @internal */\n\tprivate _handleLoggingChanged(level: LogLevel | null) {\n\t\tif (this._messaging == null) {\n\t\t\treturn;\n\t\t}\n\t\tMethodMessaging.postCall(this._messaging, 'loggingChanged', [level]);\n\t}\n}\n","export default '1.11.0';\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","PlayerSetTempoType","Internal","ExternalBpm","ExternalMidi","_module","_addFunction","_removeFunction","_fs","_addOnPostRunFn","fluid_settings_setint","fluid_settings_setnum","fluid_settings_setstr","fluid_synth_error","fluid_synth_sfload","fluid_sequencer_register_client","malloc","free","defaultMIDIEventCallback","promiseWaitForInitialized","bindFunctions","addFunction","removeFunction","addOnPostRun","Error","AudioWorkletGlobalScope","wasmModule","wasmAddFunction","wasmRemoveFunction","Module","undefined","FS","cwrap","_malloc","bind","_free","_fluid_synth_handle_midi_event","INVALID_POINTER","SequencerEventData","constructor","_ptr","getRaw","dispose","getType","_fluid_event_get_type","getSource","_fluid_event_get_source","getDest","_fluid_event_get_dest","getChannel","_fluid_event_get_channel","getKey","_fluid_event_get_key","getVelocity","_fluid_event_get_velocity","getControl","_fluid_event_get_control","getValue","_fluid_event_get_value","getProgram","_fluid_event_get_program","getData","_fluid_event_get_data","getDuration","_fluid_event_get_duration","getBank","_fluid_event_get_bank","getPitch","_fluid_event_get_pitch","getSFontId","_fluid_event_get_sfont_id","rewriteEventDataImpl","ev","event","type","_fluid_event_note","channel","vel","duration","_fluid_event_noteon","_fluid_event_noteoff","_fluid_event_all_sounds_off","_fluid_event_all_notes_off","_fluid_event_bank_select","bank","_fluid_event_program_change","preset","_fluid_event_program_select","sfontId","_fluid_event_control_change","control","_fluid_event_pitch_bend","_fluid_event_pitch_wheelsens","_fluid_event_modulation","_fluid_event_sustain","_fluid_event_pan","_fluid_event_volume","_fluid_event_reverb_send","_fluid_event_chorus_send","_fluid_event_key_pressure","_fluid_event_channel_pressure","_fluid_event_system_reset","_fluid_event_timer","data","rewriteEventData","MessageError","baseName","message","detail","super","stack","MIDIEvent","_fluid_midi_event_get_type","setType","_fluid_midi_event_set_type","_fluid_midi_event_get_channel","setChannel","_fluid_midi_event_set_channel","_fluid_midi_event_get_key","setKey","_fluid_midi_event_set_key","_fluid_midi_event_get_velocity","setVelocity","_fluid_midi_event_set_velocity","_fluid_midi_event_get_control","setControl","_fluid_midi_event_set_control","_fluid_midi_event_get_value","setValue","_fluid_midi_event_set_value","_fluid_midi_event_get_program","setProgram","_fluid_midi_event_set_program","_fluid_midi_event_get_pitch","setPitch","_fluid_midi_event_set_pitch","setSysEx","size","byteLength","ptr","Uint8Array","HEAPU8","buffer","set","_fluid_midi_event_set_sysex","setText","_fluid_midi_event_set_text","setLyrics","_fluid_midi_event_set_lyrics","fluid_sequencer_get_client_name","bound","makeEvent","_new_fluid_event","_delete_fluid_event","Sequencer","_seq","_seqId","_clientFuncMap","_initialize","close","_new_fluid_sequencer2","Promise","resolve","keys","forEach","clientIdStr","unregisterClient","Number","_delete_fluid_sequencer","registerSynthesizer","synth","val","_fluid_sequencer_unregister_client","Synthesizer","reject","TypeError","getRawSynthesizer","_fluid_sequencer_register_fluidsynth","clientId","_fluid_event_set_source","_fluid_event_set_dest","_fluid_event_unregistering","_fluid_sequencer_send_now","map","getAllRegisteredClients","c","_fluid_sequencer_count_clients","r","i","id","_fluid_sequencer_get_client_id","name","push","getClientCount","getClientInfo","index","setTimeScale","scale","_fluid_sequencer_set_time_scale","getTimeScale","_fluid_sequencer_get_time_scale","getTick","_fluid_sequencer_get_tick","sendEventAt","tick","isAbsolute","count","_fluid_sequencer_send_at","sendEventToClientAt","sendEventToClientNow","sendEventNow","eventData","removeAllEvents","_fluid_sequencer_remove_events","removeAllEventsFromClient","processSequencer","msecToProcess","_fluid_sequencer_process","setIntervalForSequencer","msec","setInterval","fluid_sfont_get_name","fluid_preset_get_name","_ptrDefaultLogFunction","Soundfont","sfontPtr","getSoundfontById","sfont","_fluid_synth_get_sfont_by_id","getName","getPreset","presetNum","presetPtr","_fluid_sfont_get_preset","soundfont","bankNum","_fluid_preset_get_banknum","num","_fluid_preset_get_num","getPresetIterable","reset","_fluid_sfont_iteration_start","next","_fluid_sfont_iteration_next","done","iterator","setBoolValueForSettings","settings","setIntValueForSettings","setNumValueForSettings","_settings","_synth","_player","_playerPlaying","_playerCallbackPtr","_fluidSynthCallback","_buffer","_bufferSize","_numPtr","_gain","initializeWithFluidSynthModule","mod","waitForWasmInitialized","e","calledRun","fn","onRuntimeInitialized","waitForInitialized","isInitialized","createAudioNode","context","frameSize","node","createScriptProcessor","addEventListener","render","outputBuffer","init","sampleRate","_new_fluid_settings","initialGain","chorusActive","chorusDepth","chorusLevel","chorusNr","chorusSpeed","midiChannelCount","setStrValueForSettings","midiBankSelect","minNoteLength","overflowAge","overflowImportantValue","overflowImportantChannels","join","overflowPercussion","overflowReleased","overflowSustained","overflowVolume","polyphony","reverbActive","reverbDamp","reverbLevel","reverbRoomSize","reverbWidth","_new_fluid_synth","_closePlayer","_delete_fluid_synth","_delete_fluid_settings","isPlaying","actualCount","_fluid_synth_get_active_voice_count","baseOffsetOfVoice","offsetOfActiveVoiceCount","structActiveVoiceCount","HEAPU32","console","warn","voiceList","voiceCount","_fluid_synth_get_polyphony","isRunning","voice","getActiveVoiceCount","setInterpolation","ensureInitialized","_fluid_synth_set_interp_method","getGain","setGain","gain","_fluid_synth_set_gain","_fluid_synth_get_gain","setChannelType","isDrum","_fluid_synth_set_channel_type","waitForVoicesStopped","flushFramesAsync","loadSFont","bin","ext","Math","random","ub","writeFile","unlink","unloadSFont","stopPlayer","flushFramesSync","_fluid_synth_sfunload","unloadSFontAsync","then","getSFontObject","getSFontBankOffset","_fluid_synth_get_bank_offset","setSFontBankOffset","offset","_fluid_synth_set_bank_offset","outBuffer","frameCount","length","channels","numberOfChannels","sizePerChannel","totalSize","memLeft","memRight","renderRaw","aLeft","Float32Array","aRight","copyToChannel","leftData","getChannelData","rightData","isPlayerPlaying","midiNoteOn","chan","_fluid_synth_noteon","midiNoteOff","_fluid_synth_noteoff","midiKeyPressure","_fluid_synth_key_pressure","midiControl","ctrl","_fluid_synth_cc","midiProgramChange","prognum","_fluid_synth_program_change","midiChannelPressure","_fluid_synth_channel_pressure","midiPitchBend","_fluid_synth_pitch_bend","midiSysEx","len","mem","_fluid_synth_sysex","midiPitchWheelSensitivity","_fluid_synth_pitch_wheel_sens","_fluid_synth_bank_select","midiSFontSelect","_fluid_synth_sfont_select","midiProgramSelect","_fluid_synth_program_select","midiUnsetProgram","_fluid_synth_unset_program","midiProgramReset","_fluid_synth_program_reset","midiSystemReset","_fluid_synth_system_reset","midiAllNotesOff","_fluid_synth_all_notes_off","midiAllSoundsOff","_fluid_synth_all_sounds_off","midiSetChannelType","setReverb","roomsize","damping","width","level","_fluid_synth_set_reverb","setReverbRoomsize","_fluid_synth_set_reverb_roomsize","setReverbDamp","_fluid_synth_set_reverb_damp","setReverbWidth","_fluid_synth_set_reverb_width","setReverbLevel","_fluid_synth_set_reverb_level","setReverbOn","on","_fluid_synth_set_reverb_on","getReverbRoomsize","_fluid_synth_get_reverb_roomsize","getReverbDamp","_fluid_synth_get_reverb_damp","getReverbLevel","_fluid_synth_get_reverb_level","getReverbWidth","_fluid_synth_get_reverb_width","setChorus","speed","depthMillisec","_fluid_synth_set_chorus","setChorusVoiceCount","_fluid_synth_set_chorus_nr","setChorusLevel","_fluid_synth_set_chorus_level","setChorusSpeed","_fluid_synth_set_chorus_speed","setChorusDepth","_fluid_synth_set_chorus_depth","setChorusType","_fluid_synth_set_chorus_type","setChorusOn","_fluid_synth_set_chorus_on","getChorusVoiceCount","_fluid_synth_get_chorus_nr","getChorusLevel","_fluid_synth_get_chorus_level","getChorusSpeed","_fluid_synth_get_chorus_speed","getChorusDepth","_fluid_synth_get_chorus_depth","getChorusType","_fluid_synth_get_chorus_type","getGenerator","param","_fluid_synth_get_gen","setGenerator","_fluid_synth_set_gen","getLegatoMode","_fluid_synth_get_legato_mode","HEAP32","setLegatoMode","mode","_fluid_synth_set_legato_mode","getPortamentoMode","_fluid_synth_get_portamento_mode","setPortamentoMode","_fluid_synth_set_portamento_mode","getBreathMode","_fluid_synth_get_breath_mode","setBreathMode","flags","_fluid_synth_set_breath_mode","resetPlayer","_initPlayer","closePlayer","player","_new_fluid_player","funcPtr","p","_delete_fluid_player","_fluid_player_get_status","addSMFDataToPlayer","ensurePlayerInitialized","_fluid_player_add_mem","playPlayer","_fluid_player_play","resolver","_playerDefer","promise","_fluid_player_stop","_fluid_player_join","retrievePlayerCurrentTick","_fluid_player_get_current_tick","retrievePlayerTotalTicks","_fluid_player_get_total_ticks","retrievePlayerBpm","_fluid_player_get_bpm","retrievePlayerMIDITempo","_fluid_player_get_midi_tempo","seekPlayer","ticks","_fluid_player_seek","setPlayerLoop","loopTimes","_fluid_player_set_loop","setPlayerTempo","tempoType","tempo","_fluid_player_set_tempo","hookPlayerMIDIEvents","callback","oldPtr","newPtr","cb","t","makeMIDIEventCallback","_fluid_player_set_playback_callback","_fluid_synth_write_float","nextFrame","setTimeout","head","tail","self","waitForPlayerStopped","createSequencer","seq","registerSequencerClient","time","waitForReady","initializeCallPort","port","hookMessage","instance","defers","deferId","hook","defer","error","makeMessageError","processReturnMessage","start","postCall","method","args","postMessage","postCallWithPromise","Infinity","transfers","MessagePort","WorkletSoundfont","_messaging","WorkletSequencer","registerSequencerClientByName","clientName","callbackName","seqPtr","AudioWorkletNodeSynthesizer","_getRawSynthesizer","v","_disabledLoggingLevel","_handlers","LOG_LEVEL_COUNT","LogLevel","Panic","Warning","Info","Debug","disableLogging","_fluid_set_log_function","l","restoreLogging","_status","playing","playerPlaying","_node","handleLoggingChanged","_handleLoggingChanged","AudioWorkletNode","numberOfInputs","numberOfOutputs","channelCount","outputChannelCount","processorOptions","disabledLoggingLevel","_sampleRate","MessageChannel","port2","port1","hookPlayerMIDIEventsByName","callFunction"],"sourceRoot":""}